<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMGC Facilities Master Plan - Multi Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        /* UMGC Official Brand Colors */
        :root {
            --umgc-gold: #F2A900;         /* UMGC Official Gold */
            --umgc-red: #D50032;          /* UMGC Official Red */
            --umgc-black: #000000;        /* UMGC Official Black */
            --umgc-navy: #003366;         /* UMGC Navy Blue (web) */
            --umgc-text-dark: #333333;    /* Dark Gray Text */
            --umgc-text-light: #666666;   /* Light Gray Text */
            --umgc-background: #FFFFFF;   /* White Background */
            --umgc-gray-light: #F5F5F5;   /* Light Gray */
            --umgc-gray-medium: #E0E0E0;  /* Medium Gray */
            --umgc-navy-dark: #002244;    /* Darker Navy */
            --umgc-blue-light: #dbeafe;   /* Light Blue */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--umgc-background);
            color: var(--umgc-text-dark);
            line-height: 1.6;
        }

        .header {
            background: white;
            color: var(--umgc-black);
            padding: 20px 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 4px solid var(--umgc-gold);
            display: grid;
            grid-template-columns: auto 1fr;
            align-items: center;
            gap: 40px;
        }

        .header-logo {
            height: 80px;
            width: auto;
            justify-self: start;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
            color: var(--umgc-black);
            letter-spacing: -0.02em;
            text-align: center;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 10px;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: var(--umgc-gray-light);
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            margin-top: 0;
            display: flex;
            border-bottom: 3px solid var(--umgc-gold);
            position: sticky;
            top: 128px;
            z-index: 999;
        }

        .tab-button {
            flex: 1;
            padding: 16px 24px;
            background: var(--umgc-background);
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--umgc-navy);
            transition: all 0.2s ease;
            position: relative;
            border-right: 1px solid var(--umgc-gray-medium);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tab-button:last-child {
            border-right: none;
        }

        .tab-button:hover {
            background: var(--umgc-gray-light);
            color: var(--umgc-red);
        }

        .tab-button.active {
            background: var(--umgc-navy);
            color: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--umgc-gold);
        }

        .tab-icon {
            margin-right: 8px;
            font-size: 1.2rem;
        }

        /* Dashboard Container */
        .dashboard-wrapper {
            background: white;
            border-radius: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: visible;
            border: 1px solid var(--umgc-gray-medium);
            border-top: none;
        }

        .tab-content {
            display: none !important;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-iframe {
            width: 100%;
            height: 95vh;
            min-height: 900px;
            border: none;
            display: block;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: var(--umgc-text-light);
        }

        .footer {
            background: var(--umgc-navy);
            color: white;
            text-align: center;
            padding: 30px 20px;
            margin-top: 40px;
            border-top: 4px solid var(--umgc-gold);
        }

        .footer p {
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .footer a {
            color: var(--umgc-gold);
            text-decoration: none;
            font-weight: 600;
        }

        .footer a:hover {
            text-decoration: underline;
            color: white;
        }

        /* Commute Analysis Styles */
        .commute-analysis-container {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .commute-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .commute-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--umgc-navy);
            margin-bottom: 15px;
        }

        .commute-info-box {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 15px;
            margin: 15px auto;
            max-width: 600px;
        }

        .commute-info-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e40af;
            margin: 0;
        }

        .commute-subtitle {
            font-size: 1rem;
            color: var(--umgc-text-light);
            margin-top: 10px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--umgc-gray-light);
            padding: 10px;
            border-radius: 12px;
        }

        .filter-tab {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: 2px solid var(--umgc-gray-medium);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--umgc-navy);
            transition: all 0.3s ease;
        }

        .filter-tab:hover {
            background: var(--umgc-gray-light);
            border-color: var(--umgc-navy);
        }

        .filter-tab.active {
            background: var(--umgc-navy);
            color: white;
            border-color: var(--umgc-navy);
        }

        .filter-tab span {
            margin-right: 8px;
            font-size: 1.2rem;
        }

        .filter-content {
            display: none;
        }

        .filter-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        .filter-card {
            background: white;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .filter-card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--umgc-navy);
            margin-bottom: 10px;
        }

        .filter-card-title span {
            margin-right: 8px;
        }

        .filter-card-desc {
            color: var(--umgc-text-light);
            margin-bottom: 20px;
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .slider-label {
            font-weight: 600;
            color: var(--umgc-navy);
        }

        .slider-value {
            color: var(--umgc-red);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: var(--umgc-gray-medium);
            outline: none;
            appearance: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--umgc-navy);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--umgc-navy);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            border: 2px solid var(--umgc-gray-medium);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-card-blue {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #ffffff 0%, #dbeafe 100%);
        }

        .stat-card-green {
            border-color: #10b981;
            background: linear-gradient(135deg, #ffffff 0%, #d1fae5 100%);
        }

        .stat-card-purple {
            border-color: #7c3aed;
            background: linear-gradient(135deg, #ffffff 0%, #ede9fe 100%);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .stat-icon {
            font-size: 1.5rem;
        }

        .stat-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--umgc-navy);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 5px;
        }

        .stat-card-green .stat-value {
            color: #10b981;
        }

        .stat-card-purple .stat-value {
            color: #7c3aed;
        }

        .stat-desc {
            font-size: 0.9rem;
            color: var(--umgc-text-light);
        }

        .stat-warning {
            font-size: 0.85rem;
            color: #f59e0b;
            margin-top: 5px;
            font-weight: 500;
        }

        .map-card {
            background: white;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .map-header {
            margin-bottom: 15px;
        }

        .map-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--umgc-navy);
            margin-bottom: 5px;
        }

        .map-title span {
            margin-right: 8px;
        }

        .map-subtitle {
            color: var(--umgc-text-light);
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .map-legend {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: var(--umgc-text-light);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .legend-green {
            background: #10b981;
        }

        .legend-gray {
            background: #94a3b8;
        }

        .legend-note {
            font-style: italic;
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            border: 1px solid var(--umgc-gray-medium);
            overflow: hidden;
            background: var(--umgc-gray-light);
            margin-bottom: 15px;
            position: relative;
        }

        .map-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            height: 100vh !important;
            border-radius: 0 !important;
            margin: 0 !important;
        }

        .fullscreen-button {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            background: white;
            border: 2px solid var(--umgc-navy);
            border-radius: 6px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: 600;
            color: var(--umgc-navy);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .fullscreen-button:hover {
            background: var(--umgc-navy);
            color: white;
        }

        .custom-marker {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .custom-marker:hover {
            transform: scale(1.2);
        }

        .mapboxgl-popup-content {
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .mapboxgl-popup-content h3 {
            margin: 0 0 10px 0;
            color: var(--umgc-navy);
            font-size: 1.1rem;
            font-weight: 700;
        }

        .mapboxgl-popup-content p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: var(--umgc-text-dark);
        }

        .mapboxgl-popup-content strong {
            color: var(--umgc-navy);
            font-weight: 600;
        }

        .map-placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: var(--umgc-text-light);
        }

        .map-placeholder p {
            margin: 5px 0;
        }

        .map-note {
            font-size: 0.85rem;
            font-style: italic;
        }

        .map-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .map-stat {
            text-align: center;
        }

        .map-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--umgc-navy);
        }

        .map-stat-green {
            color: #10b981;
        }

        .map-stat-label {
            font-size: 0.85rem;
            color: var(--umgc-text-light);
            margin-top: 5px;
        }

        .chart-card {
            background: white;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--umgc-navy);
            margin-bottom: 5px;
        }

        .chart-subtitle {
            color: var(--umgc-text-light);
            margin-bottom: 20px;
        }

        .travel-chart {
            width: 100%;
            height: 300px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: white;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-icon {
            font-size: 2rem;
        }

        .metric-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--umgc-navy);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--umgc-navy);
            margin-bottom: 5px;
        }

        .metric-desc {
            font-size: 0.85rem;
            color: var(--umgc-text-light);
        }

        /* Building Tab Navigation */
        .building-tab-navigation {
            display: flex;
            background: white;
            border-bottom: 2px solid var(--umgc-gray-light);
            margin-bottom: 0;
            padding: 0;
            overflow-x: auto;
            position: sticky;
            top: 188px;
            z-index: 998;
        }

        .building-tab-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
            background: none;
            border: none;
            color: var(--umgc-text-light);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .building-tab-button:hover {
            background: var(--umgc-gray-light);
            color: var(--umgc-navy);
        }

        .building-tab-button.active {
            color: var(--umgc-navy);
            border-bottom-color: var(--umgc-navy);
            background: var(--umgc-gray-light);
            font-weight: 600;
        }

        .building-tab-icon {
            font-size: 1.1rem;
        }

        /* Building Content */
        .building-content-wrapper {
            width: 100%;
            position: relative;
        }

        .building-content {
            display: none !important;
            visibility: hidden !important;
            pointer-events: none !important;
            position: absolute !important;
            top: -9999px !important;
            left: -9999px !important;
        }

        .building-content.active {
            display: block !important;
            visibility: visible !important;
            pointer-events: auto !important;
            position: relative !important;
            top: auto !important;
            left: auto !important;
        }

        /* Ensure building content is hidden when Dashboard 1 is not active */
        #dashboard1:not(.active) .building-content {
            display: none !important;
        }


        /* Building Comparison Styles */
        .building-comparison {
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .building-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .building-summary-card {
            background: white;
            border: 2px solid var(--umgc-gray-light);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .building-summary-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .building-summary-card.admin {
            border-left: 4px solid var(--umgc-navy);
        }

        .building-summary-card.icc {
            border-left: 4px solid var(--umgc-gold);
        }

        .building-summary-card.hotel {
            border-left: 4px solid var(--umgc-red);
        }

        .building-summary-card.combined {
            border-left: 4px solid var(--umgc-blue-light);
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .building-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--umgc-gray-light);
        }

        .building-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--umgc-navy);
        }

        .building-status {
            background: var(--umgc-green);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .building-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .metric {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--umgc-text-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--umgc-navy);
        }

        .upload-section {
            text-align: center;
            margin: 20px 0;
        }

        .upload-button {
            background: var(--umgc-navy);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-button:hover {
            background: var(--umgc-navy-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 51, 102, 0.3);
        }

        .uploaded-filename {
            display: inline-block;
            margin-left: 15px;
            padding: 8px 15px;
            background: var(--umgc-gold);
            color: var(--umgc-black);
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .alert-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .alert-box p {
            margin: 0;
            color: #92400e;
            font-size: 0.95rem;
        }

        /* Space Planning Dashboard Styles */
        .space-planning-container {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .space-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
        }

        .space-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--umgc-navy);
            margin: 0;
        }

        .space-subtitle {
            color: var(--umgc-text-light);
            font-size: 1.1rem;
            margin-top: 5px;
        }

        .space-icon {
            font-size: 4rem;
        }

        .space-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .space-metric-card {
            background: white;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--umgc-text-light);
            margin-bottom: 8px;
        }

        .metric-value-large {
            font-size: 2rem;
            font-weight: 700;
            color: var(--umgc-navy);
            margin-bottom: 5px;
        }

        .metric-info {
            font-size: 0.85rem;
            color: var(--umgc-text-light);
        }

        .metric-badge {
            display: inline-block;
            margin-top: 8px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .metric-badge.over-capacity {
            background: #fee2e2;
            color: #991b1b;
        }

        .space-card {
            background: white;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .space-card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--umgc-navy);
            margin: 0 0 8px 0;
        }

        .space-card-desc {
            color: var(--umgc-text-light);
            margin-bottom: 20px;
        }

        .collapsible-header:hover {
            opacity: 0.9;
            box-shadow: 0 4px 12px rgba(0, 51, 102, 0.3);
        }

        .collapsible-content {
            transition: max-height 0.4s ease, opacity 0.3s ease;
        }

        .category-header:hover {
            opacity: 0.85;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .building-params-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .param-control {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .param-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .param-label {
            font-weight: 600;
            color: var(--umgc-navy);
        }

        .param-value {
            font-weight: 600;
            color: var(--umgc-red);
            font-size: 1.1rem;
        }

        .space-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 280px));
            gap: 15px;
            justify-content: start;
        }
        
        .space-types-grid.workstation-spaces,
        .space-types-grid.office-spaces,
        .space-types-grid.collab-spaces,
        .space-types-grid.other-spaces {
            grid-template-columns: repeat(auto-fit, minmax(280px, 280px));
            justify-content: start;
        }

        .space-type-card {
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 8px;
            padding: 10px;
            background: white;
            min-height: 140px;
            max-width: 280px;
            width: 280px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            box-sizing: border-box;
            gap: 6px;
        }

        .space-type-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .space-type-name {
            font-weight: 600;
            color: var(--umgc-navy);
            font-size: 1rem;
        }

        .space-type-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .space-type-inputs {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
            align-items: end;
            flex-wrap: nowrap;
            justify-content: space-between;
        }

        .space-input-group {
            display: flex;
            flex-direction: column;
            gap: 3px;
            flex: 1;
        }

        .space-input-group:last-child {
            flex: 0 0 60px;
        }

        .space-input-label {
            font-size: 0.7rem;
            color: var(--umgc-text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .space-input {
            padding: 4px 6px;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 4px;
            font-size: 0.8rem;
            width: 100%;
            max-width: 80px;
        }

        .space-qty-display {
            padding: 4px 8px;
            font-weight: 600;
            color: var(--umgc-navy);
            background: var(--umgc-gray-light);
            border-radius: 4px;
            text-align: center;
            font-size: 0.85rem;
        }

        .space-type-card .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--umgc-gray-medium);
            outline: none;
            appearance: none;
            -webkit-appearance: none;
            margin-top: 4px;
        }

        .space-type-card .slider::-webkit-slider-thumb {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--umgc-navy);
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .space-type-card .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--umgc-navy);
            cursor: pointer;
            border: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .space-type-total {
            display: flex;
            justify-content: space-between;
            padding-top: 10px;
            border-top: 1px solid var(--umgc-gray-light);
            margin-top: 10px;
        }

        .space-total-label {
            color: var(--umgc-text-light);
            font-size: 0.9rem;
        }

        .space-total-value {
            font-weight: 700;
            color: var(--umgc-navy);
        }

        .custom-space-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .custom-input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .custom-label {
            font-weight: 600;
            color: var(--umgc-navy);
            font-size: 0.9rem;
        }

        .custom-input {
            padding: 10px 12px;
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .add-space-button {
            background: var(--umgc-navy);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-space-button:hover {
            background: var(--umgc-navy-dark);
            transform: translateY(-1px);
        }

        .custom-spaces-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .custom-space-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--umgc-gray-light);
            border: 1px solid var(--umgc-gray-medium);
            border-radius: 8px;
            padding: 15px;
        }

        .custom-space-info {
            flex: 1;
        }

        .custom-space-name {
            font-weight: 600;
            color: var(--umgc-navy);
            margin-bottom: 4px;
        }

        .custom-space-details {
            font-size: 0.9rem;
            color: var(--umgc-text-light);
        }

        .remove-space-button {
            background: var(--umgc-red);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .remove-space-button:hover {
            background: #c42a21;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .space-chart {
            width: 100% !important;
            height: 300px !important;
            max-width: 100% !important;
            max-height: 300px !important;
        }
        
        .charts-grid .space-card {
            min-height: 400px;
            max-height: 450px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .space-table {
            width: 100%;
            border-collapse: collapse;
        }

        .space-table th {
            background: var(--umgc-gray-light);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--umgc-navy);
            border-bottom: 2px solid var(--umgc-gray-medium);
        }

        .space-table th.text-right {
            text-align: right;
        }

        .space-table td {
            padding: 12px;
            border-bottom: 1px solid var(--umgc-gray-light);
        }

        .space-table td.text-right {
            text-align: right;
        }

        .space-table tr:hover {
            background: var(--umgc-gray-light);
        }

        .color-swatch {
            width: 64px;
            height: 20px;
            border-radius: 4px;
        }

        .alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .alert-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
        }

        .alert-modal-content {
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 10001;
        }

        .alert-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--umgc-red);
            margin: 0 0 15px 0;
        }

        .alert-modal-body p {
            margin-bottom: 15px;
            color: var(--umgc-text-dark);
        }

        .alert-modal-stats {
            background: #fee2e2;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .alert-modal-stats p {
            margin: 5px 0;
            font-weight: 600;
        }

        .alert-over {
            color: var(--umgc-red);
            font-size: 1.1rem;
        }

        .alert-suggestion {
            font-size: 0.9rem;
            color: var(--umgc-text-light);
        }

        .alert-modal-button {
            background: var(--umgc-navy);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }

        .alert-modal-button:hover {
            background: var(--umgc-navy-dark);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
                text-align: center;
            }

            .header-logo {
                height: 60px;
                justify-self: center;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .tab-navigation {
                flex-direction: column;
            }

            .tab-button {
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
                padding: 15px 20px;
            }

            .tab-button:last-child {
                border-bottom: none;
            }
            
            .container {
                padding: 10px;
            }
            
            .dashboard-iframe {
                height: 85vh;
                min-height: 700px;
            }

            .commute-analysis-container {
                padding: 15px;
            }

            .commute-title {
                font-size: 1.8rem;
            }

            .filter-tabs {
                flex-direction: column;
            }

            .stats-grid,
            .metrics-grid,
            .map-stats {
                grid-template-columns: 1fr;
            }

            .map-container {
                height: 300px;
            }

            .space-planning-container {
                padding: 15px;
            }

            .space-title {
                font-size: 1.8rem;
            }

            .space-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .space-icon {
                font-size: 2.5rem;
            }

            .space-metrics-grid,
            .building-params-grid,
            .space-types-grid,
            .custom-space-inputs,
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="UMGC-logo-stacked-rgb.png" alt="UMGC Logo" class="header-logo">
        <div class="header-content">
            <h1>Facilities Master Plan</h1>
        </div>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('powerbi')" id="tab3-btn">
                <span class="tab-icon">âš¡</span>
                Existing Conditions
            </button>
            <button class="tab-button" onclick="switchTab('dashboard1')" id="tab1-btn">
                <span class="tab-icon">ðŸ“Š</span>
                Space Planning
            </button>
            <button class="tab-button" onclick="switchTab('dashboard2')" id="tab2-btn">
                <span class="tab-icon">ðŸ“ˆ</span>
                Commuter Analysis
            </button>
        </div>

        <!-- Dashboard Container -->
        <div class="dashboard-wrapper">
            <!-- Dashboard 1 Content - Space Planning -->
            <div id="dashboard1" class="tab-content">
                <!-- Building Selection Tabs -->
                <div class="building-tab-navigation">
                    <button class="building-tab-button active" onclick="switchBuilding('admin')" id="admin-building-btn">
                        <img src="adminbuilding.jpg" alt="Admin Building" style="width: 24px; height: 24px; object-fit: cover; border-radius: 4px; margin-right: 8px;">
                        Admin Building
                    </button>
                    <button class="building-tab-button" onclick="switchBuilding('icc')" id="icc-building-btn">
                        <img src="ICC.jpg" alt="ICC Building" style="width: 24px; height: 24px; object-fit: cover; border-radius: 4px; margin-right: 8px;">
                        ICC Building
                    </button>
                    <button class="building-tab-button" onclick="switchBuilding('hotel')" id="hotel-building-btn">
                        <img src="hotel.jpg" alt="Hotel Building" style="width: 24px; height: 24px; object-fit: cover; border-radius: 4px; margin-right: 8px;">
                        Hotel Building
                    </button>
                    <button class="building-tab-button" onclick="switchBuilding('comparison')" id="comparison-building-btn">
                        <img src="adelphicampus.png" alt="Adelphi Campus" style="width: 24px; height: 24px; object-fit: cover; border-radius: 4px; margin-right: 8px;">
                        Adelphi Campus
                    </button>
                        </div>

                <!-- Container for all building content -->
                <div class="building-content-wrapper">
                <!-- Admin Building Content -->
                <div id="admin-building-content" class="building-content active">
                    <!-- Sticky Comparison Header -->
                    <div class="collapsible-header" onclick="toggleComparison()" style="cursor: pointer; padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-red) 0%, #b91c1c 100%); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); position: sticky; top: 245px; z-index: 997; margin: 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                <h3 style="color: white; margin: 0; font-size: 1.3rem; font-weight: 700;">Admin Building</h3>
                                <div style="display: flex; align-items: center; gap: 20px; flex: 1; justify-content: center;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Remaining SF</div>
                                        <div id="remainingSF" style="color: white; font-size: 1.2rem; font-weight: 700;">68,000</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Assignable SF</div>
                                        <div id="deltaGSF" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                        </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Workstations</div>
                                        <div id="deltaWorkstations" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Private Offices</div>
                                        <div id="deltaOffices" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Collab Spaces</div>
                                        <div id="deltaSpaces" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Collab Seats</div>
                                        <div id="deltaSeats" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <span id="comparisonToggle" style="color: white; font-size: 1.5rem; transition: transform 0.3s; margin-left: 10px;">â–¼</span>
                                </div>
                            </div>
                    </div>

                <!-- Comparison Content -->
                <div id="comparisonContent" class="collapsible-content" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                    <div class="space-planning-container">
                        <div class="space-card">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                                    <!-- Existing Conditions -->
                                    <div style="background: var(--umgc-gray-light); padding: 20px; border-radius: 8px; border-left: 4px solid var(--umgc-red);">
                                        <h4 style="color: var(--umgc-navy); font-size: 1rem; font-weight: 700; margin: 0 0 15px 0;">Existing Conditions</h4>
                                        <div style="display: flex; flex-direction: column; gap: 12px;">
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Assignable SF</span>
                                                <span style="color: var(--umgc-navy); font-weight: 700;">52,000</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Workstations</span>
                                                <span style="color: var(--umgc-navy); font-weight: 700;">40 spaces</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Private Offices</span>
                                                <span style="color: var(--umgc-navy); font-weight: 700;">25 spaces</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Collab Spaces</span>
                                                <span style="color: var(--umgc-navy); font-weight: 700;">12 spaces</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Collab Seats</span>
                                                <span style="color: var(--umgc-navy); font-weight: 700;">85 seats</span>
                                            </div>
                                        </div>
                        </div>

                                    <!-- Planned Conditions -->
                                    <div style="background: var(--umgc-gray-light); padding: 20px; border-radius: 8px; border-left: 4px solid hsl(142, 76%, 36%);">
                                        <h4 style="color: var(--umgc-navy); font-size: 1rem; font-weight: 700; margin: 0 0 15px 0;">Planned Conditions</h4>
                                        <div style="display: flex; flex-direction: column; gap: 12px;">
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Assignable SF</span>
                                                <span id="plannedAssignable" style="color: var(--umgc-navy); font-weight: 700;">68,000</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Workstations</span>
                                                <span id="plannedWorkstation" style="color: var(--umgc-navy); font-weight: 700;">0 spaces</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Private Offices</span>
                                                <span id="plannedOffice" style="color: var(--umgc-navy); font-weight: 700;">0 spaces</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Collab Spaces</span>
                                                <span id="plannedCollab" style="color: var(--umgc-navy); font-weight: 700;">0 spaces</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 4px;">
                                                <span style="color: var(--umgc-text-dark); font-weight: 600;">Collab Seats</span>
                                                <span id="plannedSeats" style="color: var(--umgc-navy); font-weight: 700;">0 seats</span>
                                            </div>
                                        </div>
                        </div>

                                </div>
                            </div>
                        </div>
                        </div>

                <div class="space-planning-container">
                    <!-- Header -->
                    <div class="space-header">
                        <div>
                            <h2 class="space-title">Admin Building</h2>
                        </div>
                    </div>

                    <!-- Building Parameters -->
                    <div class="space-card">
                        <div class="collapsible-header" onclick="toggleBuildingParams()" style="cursor: pointer; padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-navy) 0%, var(--umgc-navy-dark) 100%); border-radius: 8px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                <h3 style="color: white; margin: 0; font-size: 1.1rem; font-weight: 600;">Building Parameters</h3>
                                <div style="display: flex; gap: 30px; align-items: center; flex: 1; justify-content: flex-end;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total GSF</div>
                                        <div id="totalBuildingGSF" style="color: white; font-size: 1.1rem; font-weight: 700;">80,000</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Assignable SF</div>
                                        <div id="totalAssignableSF" style="color: white; font-size: 1.1rem; font-weight: 700;">68,000</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Efficiency</div>
                                        <div id="overallEfficiency" style="color: white; font-size: 1.1rem; font-weight: 700;">85%</div>
                                    </div>
                                    <span id="buildingParamsToggle" style="color: white; font-size: 1.5rem; transition: transform 0.3s; margin-left: 10px;">â–¼</span>
                                </div>
                            </div>
                        </div>
                        <div id="buildingParamsContent" class="collapsible-content" style="max-height: 2000px; overflow: hidden; transition: max-height 0.4s ease;">
                            <div class="building-params-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
                                <!-- Floor 1 -->
                            <div class="param-control" style="border: 2px solid var(--umgc-navy); border-radius: 8px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                                <h4 style="color: var(--umgc-navy); font-size: 1rem; margin-bottom: 10px; font-weight: 700;">Floor 1</h4>
                                <div class="param-header">
                                    <label class="param-label">GSF</label>
                                    <span class="param-value" id="floor1Value">20,000</span>
                                </div>
                                <input type="range" class="slider" id="floor1Slider" min="5000" max="50000" value="20000" step="1000" oninput="updateFloor(1, this.value)">
                                <div class="param-header" style="margin-top: 10px;">
                                    <label class="param-label">Efficiency</label>
                                    <span class="param-value" id="floor1EffValue">85%</span>
                                </div>
                                <input type="range" class="slider" id="floor1EffSlider" min="60" max="95" value="85" step="1" oninput="updateFloorEfficiency(1, this.value)">
                                <div style="margin-top: 8px; padding: 8px; background: var(--umgc-blue-light); border-radius: 4px;">
                                    <span style="font-size: 0.8rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="floor1Assignable">17,000</span></span>
                                </div>
                            </div>

                            <!-- Floor 2 -->
                            <div class="param-control" style="border: 2px solid var(--umgc-navy); border-radius: 8px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                                <h4 style="color: var(--umgc-navy); font-size: 1rem; margin-bottom: 10px; font-weight: 700;">Floor 2</h4>
                                <div class="param-header">
                                    <label class="param-label">GSF</label>
                                    <span class="param-value" id="floor2Value">20,000</span>
                                </div>
                                <input type="range" class="slider" id="floor2Slider" min="5000" max="50000" value="20000" step="1000" oninput="updateFloor(2, this.value)">
                                <div class="param-header" style="margin-top: 10px;">
                                    <label class="param-label">Efficiency</label>
                                    <span class="param-value" id="floor2EffValue">85%</span>
                                </div>
                                <input type="range" class="slider" id="floor2EffSlider" min="60" max="95" value="85" step="1" oninput="updateFloorEfficiency(2, this.value)">
                                <div style="margin-top: 8px; padding: 8px; background: var(--umgc-blue-light); border-radius: 4px;">
                                    <span style="font-size: 0.8rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="floor2Assignable">17,000</span></span>
                                </div>
                            </div>

                            <!-- Floor 3 -->
                            <div class="param-control" style="border: 2px solid var(--umgc-navy); border-radius: 8px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                                <h4 style="color: var(--umgc-navy); font-size: 1rem; margin-bottom: 10px; font-weight: 700;">Floor 3</h4>
                                <div class="param-header">
                                    <label class="param-label">GSF</label>
                                    <span class="param-value" id="floor3Value">20,000</span>
                                </div>
                                <input type="range" class="slider" id="floor3Slider" min="5000" max="50000" value="20000" step="1000" oninput="updateFloor(3, this.value)">
                                <div class="param-header" style="margin-top: 10px;">
                                    <label class="param-label">Efficiency</label>
                                    <span class="param-value" id="floor3EffValue">85%</span>
                                </div>
                                <input type="range" class="slider" id="floor3EffSlider" min="60" max="95" value="85" step="1" oninput="updateFloorEfficiency(3, this.value)">
                                <div style="margin-top: 8px; padding: 8px; background: var(--umgc-blue-light); border-radius: 4px;">
                                    <span style="font-size: 0.8rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="floor3Assignable">17,000</span></span>
                                </div>
                            </div>

                            <!-- Floor 4 -->
                            <div class="param-control" style="border: 2px solid var(--umgc-navy); border-radius: 8px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                                <h4 style="color: var(--umgc-navy); font-size: 1rem; margin-bottom: 10px; font-weight: 700;">Floor 4</h4>
                                <div class="param-header">
                                    <label class="param-label">GSF</label>
                                    <span class="param-value" id="floor4Value">20,000</span>
                                </div>
                                <input type="range" class="slider" id="floor4Slider" min="5000" max="50000" value="20000" step="1000" oninput="updateFloor(4, this.value)">
                                <div class="param-header" style="margin-top: 10px;">
                                    <label class="param-label">Efficiency</label>
                                    <span class="param-value" id="floor4EffValue">85%</span>
                                </div>
                                <input type="range" class="slider" id="floor4EffSlider" min="60" max="95" value="85" step="1" oninput="updateFloorEfficiency(4, this.value)">
                                <div style="margin-top: 8px; padding: 8px; background: var(--umgc-blue-light); border-radius: 4px;">
                                    <span style="font-size: 0.8rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="floor4Assignable">17,000</span></span>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>

                    <!-- Space Allocation Controls -->
                    <div class="space-card">
                        <div class="collapsible-header" style="padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-navy) 0%, var(--umgc-navy-dark) 100%); border-radius: 8px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                    <h3 style="color: white; margin: 0; font-size: 1.1rem; font-weight: 600; cursor: pointer;" onclick="toggleSpaceAllocation()">Space Allocation</h3>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px;">
                                        <input type="checkbox" id="showExistingToggle" onchange="toggleExistingData()" checked style="cursor: pointer;">
                                        <span style="color: white; font-size: 0.85rem; font-weight: 600;">Show Existing</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px;">
                                        <input type="checkbox" id="assignByFloorToggle" onchange="toggleFloorAssignment()" style="cursor: pointer;">
                                        <span style="color: white; font-size: 0.85rem; font-weight: 600;">Assign by Floor</span>
                                    </label>
                                </div>
                                <div style="display: flex; gap: 25px; align-items: center; flex: 1; justify-content: flex-end;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total Assigned</div>
                                        <div id="totalAssignedSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Office</div>
                                        <div id="totalOfficeSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Collaboration</div>
                                        <div id="totalCollabSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Other</div>
                                        <div id="totalOtherSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                    </div>
                                    <span id="spaceAllocationToggle" style="color: white; font-size: 1.5rem; transition: transform 0.3s; margin-left: 10px;">â–¼</span>
                                </div>
                            </div>
                        </div>
                        <div id="spaceAllocationContent" class="collapsible-content" style="max-height: 3000px; overflow: hidden; transition: max-height 0.4s ease;">
                            
                            <!-- Workstation Spaces -->
                            <div style="margin-bottom: 25px;">
                                <div class="category-header" onclick="toggleCategory('workstation')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(217, 91%, 60%) 0%, hsl(217, 91%, 70%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Workstations</h4>
                                        <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                            <span id="workstationCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                            <span id="workstationSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                        </div>
                                    </div>
                                    <span id="workstationToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                </div>
                                <div id="workstationContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                    <div class="space-types-grid" id="workstationSpacesGrid">
                                        <!-- Workstation space types will be dynamically generated -->
                                    </div>
                        </div>
                    </div>

                            <!-- Office Spaces -->
                            <div style="margin-bottom: 25px;">
                                <div class="category-header" onclick="toggleCategory('office')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(142, 76%, 36%) 0%, hsl(142, 76%, 46%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Office Spaces</h4>
                                        <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                            <span id="officeCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                            <span id="officeSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                        </div>
                                    </div>
                                    <span id="officeToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                </div>
                                <div id="officeContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                    <div class="space-types-grid" id="officeSpacesGrid">
                                        <!-- Office space types will be dynamically generated -->
                                    </div>
                                </div>
                            </div>

                            <!-- Collaboration Spaces -->
                            <div style="margin-bottom: 25px;">
                                <div class="category-header" onclick="toggleCategory('collab')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(47, 96%, 53%) 0%, hsl(47, 96%, 63%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <h4 style="color: var(--umgc-navy); font-size: 1rem; font-weight: 700; margin: 0;">Collaboration Spaces</h4>
                                        <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                            <span id="collabCount" style="color: var(--umgc-navy); font-weight: 600;">0 spaces</span>
                                            <span id="collabSeats" style="color: var(--umgc-navy); font-weight: 600;">0 seats</span>
                                            <span id="collabSubtotal" style="color: var(--umgc-navy); font-weight: 600;">0 SF</span>
                                        </div>
                                    </div>
                                    <span id="collabToggle" style="color: var(--umgc-navy); font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                </div>
                                <div id="collabContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                    <div class="space-types-grid" id="collabSpacesGrid">
                                        <!-- Collaboration space types will be dynamically generated -->
                                    </div>
                                </div>
                            </div>

                            <!-- Other Spaces -->
                            <div style="margin-bottom: 20px;">
                                <div class="category-header" onclick="toggleCategory('other')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(280, 65%, 60%) 0%, hsl(280, 65%, 70%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Other Spaces</h4>
                                        <span id="otherSubtotal" style="color: rgba(255,255,255,0.9); font-size: 0.9rem; font-weight: 600;">0 SF</span>
                                    </div>
                                    <span id="otherToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                </div>
                                <div id="otherContent" style="max-height: 1500px; overflow: hidden; transition: max-height 0.4s ease;">
                                    <div class="space-types-grid" id="otherSpacesGrid">
                                        <!-- Other space types will be dynamically generated -->
                                    </div>
                                
                                    <!-- Custom Space Input -->
                                <div style="margin-top: 20px; padding: 15px; background: var(--umgc-gray-light); border-radius: 8px;">
                                    <h5 style="color: var(--umgc-navy); font-size: 0.9rem; font-weight: 600; margin-bottom: 10px;">Add Custom Space</h5>
                        <div class="custom-space-inputs">
                            <div class="custom-input-group">
                                <label class="custom-label">Space Name</label>
                                <input type="text" class="custom-input" id="customName" placeholder="e.g., Storage Room">
                            </div>
                            <div class="custom-input-group">
                                <label class="custom-label">Square Feet</label>
                                <input type="number" class="custom-input" id="customSF" placeholder="e.g., 200">
                            </div>
                            <div class="custom-input-group">
                                <label class="custom-label">Qty</label>
                                <input type="number" class="custom-input" id="customQty" placeholder="e.g., 2">
                            </div>
                            <div class="custom-input-group">
                                <button class="add-space-button" onclick="addCustomSpace()">
                                    âž• Add Space
                                </button>
                            </div>
                        </div>

                                    <div id="customSpacesList" class="custom-spaces-list" style="margin-top: 15px;"></div>
                    </div>
                        </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-grid">
                    <div class="space-card">
                            <h3 class="space-card-title">Space Allocation by Category - Existing vs Planned</h3>
                            <p class="space-card-desc">Comparison of space distribution across categories</p>
                            <div style="position: relative; height: 300px; width: 100%;">
                                <canvas id="categoryComparisonChart" class="space-chart"></canvas>
                        </div>
                    </div>

                    <div class="space-card">
                            <h3 class="space-card-title">Space Types - Existing vs Planned</h3>
                            <p class="space-card-desc">Comparison of space types between existing and planned conditions</p>
                            <div style="position: relative; height: 300px; width: 100%;">
                                <canvas id="typeComparisonChart" class="space-chart"></canvas>
                        </div>
                    </div>
                    </div>

                </div>

                <!-- Over Capacity Alert Modal -->
                <div id="capacityAlert" class="alert-modal" style="display: none;">
                    <div class="alert-modal-overlay" onclick="closeCapacityAlert()"></div>
                    <div class="alert-modal-content">
                        <h3 class="alert-modal-title">
                            âš ï¸ Over Assignable Square Footage Limit
                        </h3>
                        <div class="alert-modal-body">
                            <p>You have exceeded the total assignable square footage allowed for this building configuration.</p>
                            <div class="alert-modal-stats">
                                <p>Assignable SF: <span id="alertAssignableSF">0</span> SF</p>
                                <p>Used SF: <span id="alertUsedSF">0</span> SF</p>
                                <p class="alert-over">Over by: <span id="alertOverSF">0</span> SF</p>
                            </div>
                            <p class="alert-suggestion">
                                Please adjust your space allocations, increase the number of floors, increase the GSF per floor, or improve the efficiency percentage.
                            </p>
                        </div>
                        <button class="alert-modal-button" onclick="closeCapacityAlert()">Understood</button>
                    </div>
                </div>
            </div>

                <!-- ICC Building Content -->
                <div id="icc-building-content" class="building-content" style="display: none;">
                    <!-- Sticky Comparison Header for ICC -->
                    <div class="collapsible-header" onclick="toggleICCComparison()" style="cursor: pointer; padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-red) 0%, #b91c1c 100%); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); position: sticky; top: 245px; z-index: 997; margin: 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                <h3 style="color: white; margin: 0; font-size: 1.3rem; font-weight: 700;">ICC Building</h3>
                                <div style="display: flex; align-items: center; gap: 20px; flex: 1; justify-content: center;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Remaining SF</div>
                                        <div id="iccRemainingSF" style="color: white; font-size: 1.2rem; font-weight: 700;">24,000</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Assignable SF</div>
                                        <div id="iccDeltaGSF" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                        </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Workstations</div>
                                        <div id="iccDeltaWorkstations" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Private Offices</div>
                                        <div id="iccDeltaOffices" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Collab Spaces</div>
                                        <div id="iccDeltaSpaces" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Collab Seats</div>
                                        <div id="iccDeltaSeats" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <span id="iccComparisonToggle" style="color: white; font-size: 1.5rem; transition: transform 0.3s; margin-left: 10px;">â–¼</span>
                                </div>
                            </div>
                    </div>
                    
                    <div class="space-planning-container">
                        <div class="space-title">
                            <h2>ICC Building</h2>
                        </div>
                        
                        <!-- ICC Building Parameters -->
                        <div class="space-card">
                            <div class="collapsible-header" onclick="toggleICCBuildingParams()" style="cursor: pointer; padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-gold) 0%, #d97706 100%); border-radius: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                    <h3 style="color: white; margin: 0; font-size: 1.1rem; font-weight: 600;">ICC Building Parameters</h3>
                                    <div style="display: flex; gap: 25px; align-items: center; flex: 1; justify-content: flex-end;">
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total Building GSF</div>
                                            <div id="iccBuildingTotalGSF" style="color: white; font-size: 1.1rem; font-weight: 700;">30,000</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total Assignable SF</div>
                                            <div id="iccBuildingTotalAssignable" style="color: white; font-size: 1.1rem; font-weight: 700;">24,000</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Overall Efficiency</div>
                                            <div id="iccBuildingOverallEfficiency" style="color: white; font-size: 1.1rem; font-weight: 700;">80%</div>
                                        </div>
                                    </div>
                                    <span id="iccBuildingParamsToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s ease;">â–¼</span>
                                </div>
                            </div>
                            <div id="iccBuildingParamsContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease;">
                                <div style="padding: 20px;">
                                    <p style="color: var(--umgc-text-light); margin-bottom: 20px; font-size: 0.9rem;">ICC Building - Conference and Meeting Center</p>
                                    
                                    <!-- ICC Building Floors -->
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 1 GSF</span>
                                                <span class="slider-value" id="iccFloor1Value">15,000</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor1Slider" min="5000" max="25000" value="15000" step="1000" oninput="updateICCFloor(1, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="iccFloor1EffValue">80%</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor1EffSlider" min="60" max="95" value="80" step="1" oninput="updateICCFloorEfficiency(1, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="iccFloor1Assignable">12,000</span></span>
                                            </div>
                                        </div>
                                        
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 2 GSF</span>
                                                <span class="slider-value" id="iccFloor2Value">15,000</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor2Slider" min="5000" max="25000" value="15000" step="1000" oninput="updateICCFloor(2, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="iccFloor2EffValue">80%</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor2EffSlider" min="60" max="95" value="80" step="1" oninput="updateICCFloorEfficiency(2, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="iccFloor2Assignable">12,000</span></span>
                                            </div>
                                        </div>
                                        
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 3 GSF</span>
                                                <span class="slider-value" id="iccFloor3Value">15,000</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor3Slider" min="5000" max="25000" value="15000" step="1000" oninput="updateICCFloor(3, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="iccFloor3EffValue">80%</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor3EffSlider" min="60" max="95" value="80" step="1" oninput="updateICCFloorEfficiency(3, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="iccFloor3Assignable">12,000</span></span>
                                            </div>
                                        </div>
                                        
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 4 GSF</span>
                                                <span class="slider-value" id="iccFloor4Value">15,000</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor4Slider" min="5000" max="25000" value="15000" step="1000" oninput="updateICCFloor(4, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="iccFloor4EffValue">80%</span>
                                            </div>
                                            <input type="range" class="slider" id="iccFloor4EffSlider" min="60" max="95" value="80" step="1" oninput="updateICCFloorEfficiency(4, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="iccFloor4Assignable">12,000</span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ICC Space Allocation -->
                        <div class="space-card">
                            <div class="collapsible-header" style="padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-gold) 0%, #d97706 100%); border-radius: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                        <h3 style="color: white; margin: 0; font-size: 1.1rem; font-weight: 600; cursor: pointer;" onclick="toggleICCSpaceAllocation()">ICC Space Allocation</h3>
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px;">
                                            <input type="checkbox" id="iccShowExistingToggle" onchange="toggleICCExistingData()" checked style="cursor: pointer;">
                                            <span style="color: white; font-size: 0.85rem; font-weight: 600;">Show Existing</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px;">
                                            <input type="checkbox" id="iccAssignByFloorToggle" onchange="toggleICCFloorAssignment()" style="cursor: pointer;">
                                            <span style="color: white; font-size: 0.85rem; font-weight: 600;">Assign by Floor</span>
                                        </label>
                                    </div>
                                    <div style="display: flex; gap: 25px; align-items: center; flex: 1; justify-content: flex-end;">
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total Assigned</div>
                                            <div id="iccTotalAssignedSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Office</div>
                                            <div id="iccTotalOfficeSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Collaboration</div>
                                            <div id="iccTotalCollabSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Other</div>
                                            <div id="iccTotalOtherSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                    </div>
                                    <span id="iccSpaceAllocationToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s ease;">â–¼</span>
                                </div>
                            </div>
                            <div id="iccSpaceAllocationContent" style="max-height: 2000px; overflow: hidden; transition: max-height 0.3s ease;">
                                <div style="padding: 20px;">
                                    <p style="color: var(--umgc-text-light); margin-bottom: 20px; font-size: 0.9rem;">ICC Building - Conference and Meeting Facilities</p>
                                    
                                    <!-- Workstation Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleICCCategory('workstation')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(217, 91%, 60%) 0%, hsl(217, 91%, 70%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Workstations</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="iccWorkstationCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="iccWorkstationSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="iccWorkstationToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="iccWorkstationContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="iccWorkstationSpacesGrid">
                                                <!-- Workstation space types will be dynamically generated -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Office Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleICCCategory('office')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(142, 76%, 36%) 0%, hsl(142, 76%, 46%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Office Spaces</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="iccOfficeCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="iccOfficeSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="iccOfficeToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="iccOfficeContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="iccOfficeSpacesGrid">
                                                <!-- Office space types will be dynamically generated -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Collaboration Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleICCCategory('collab')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(280, 65%, 60%) 0%, hsl(280, 65%, 70%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Collaboration Spaces</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="iccCollabCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="iccCollabSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="iccCollabToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="iccCollabContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="iccCollabSpacesGrid">
                                                <!-- Collaboration space types will be dynamically generated -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Other Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleICCCategory('other')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(45, 93%, 47%) 0%, hsl(45, 93%, 57%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Other Spaces</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="iccOtherCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="iccOtherSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="iccOtherToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="iccOtherContent" style="max-height: 1500px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="iccOtherSpacesGrid">
                                                <!-- Other space types will be dynamically generated -->
                                            </div>
                                            
                                            <!-- Custom Space Input -->
                                            <div style="margin-top: 20px; padding: 15px; background: var(--umgc-gray-light); border-radius: 8px;">
                                                <h5 style="color: var(--umgc-navy); font-size: 0.9rem; font-weight: 600; margin-bottom: 10px;">Add Custom Space</h5>
                                                <div class="custom-space-inputs">
                                                    <div class="custom-input-group">
                                                        <label class="custom-label">Space Name</label>
                                                        <input type="text" class="custom-input" id="iccCustomName" placeholder="e.g., Storage Room">
                                                    </div>
                                                    <div class="custom-input-group">
                                                        <label class="custom-label">Square Feet</label>
                                                        <input type="number" class="custom-input" id="iccCustomSF" placeholder="e.g., 200">
                                                    </div>
                                                    <div class="custom-input-group">
                                                        <label class="custom-label">Qty</label>
                                                        <input type="number" class="custom-input" id="iccCustomQty" placeholder="e.g., 2">
                                                    </div>
                                                    <div class="custom-input-group">
                                                        <button class="add-space-button" onclick="addICCCustomSpace()">
                                                            âž• Add Space
                                                        </button>
                                                    </div>
                                                </div>
                                                <div id="iccCustomSpacesList" class="custom-spaces-list" style="margin-top: 15px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hotel Building Content -->
                <div id="hotel-building-content" class="building-content" style="display: none;">
                    <!-- Sticky Comparison Header for Hotel -->
                    <div class="collapsible-header" onclick="toggleHotelComparison()" style="cursor: pointer; padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-red) 0%, #b91c1c 100%); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); position: sticky; top: 245px; z-index: 997; margin: 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                <h3 style="color: white; margin: 0; font-size: 1.3rem; font-weight: 700;">Hotel Building</h3>
                                <div style="display: flex; align-items: center; gap: 20px; flex: 1; justify-content: center;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Remaining SF</div>
                                        <div id="hotelRemainingSF" style="color: white; font-size: 1.2rem; font-weight: 700;">37,500</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Assignable SF</div>
                                        <div id="hotelDeltaGSF" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                        </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Workstations</div>
                                        <div id="hotelDeltaWorkstations" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Private Offices</div>
                                        <div id="hotelDeltaOffices" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Collab Spaces</div>
                                        <div id="hotelDeltaSpaces" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="color: white; font-size: 0.7rem; margin-bottom: 2px;">Collab Seats</div>
                                        <div id="hotelDeltaSeats" style="color: white; font-size: 1rem; font-weight: 700;">+0</div>
                                    </div>
                                    <span id="hotelComparisonToggle" style="color: white; font-size: 1.5rem; transition: transform 0.3s; margin-left: 10px;">â–¼</span>
                                </div>
                            </div>
                    </div>
                    
                    <div class="space-planning-container">
                        <div class="space-title">
                            <h2>Hotel Building</h2>
                        </div>

                        <!-- Hotel Building Parameters -->
                        <div class="space-card">
                            <div class="collapsible-header" onclick="toggleHotelBuildingParams()" style="cursor: pointer; padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-red) 0%, #dc2626 100%); border-radius: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                    <h3 style="color: white; margin: 0; font-size: 1.1rem; font-weight: 600;">Hotel Building Parameters</h3>
                                    <div style="display: flex; gap: 25px; align-items: center; flex: 1; justify-content: flex-end;">
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total Building GSF</div>
                                            <div id="hotelBuildingTotalGSF" style="color: white; font-size: 1.1rem; font-weight: 700;">50,000</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total Assignable SF</div>
                                            <div id="hotelBuildingTotalAssignable" style="color: white; font-size: 1.1rem; font-weight: 700;">37,500</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Overall Efficiency</div>
                                            <div id="hotelBuildingOverallEfficiency" style="color: white; font-size: 1.1rem; font-weight: 700;">75%</div>
                                        </div>
                                    </div>
                                    <span id="hotelBuildingParamsToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s ease;">â–¼</span>
                                </div>
                            </div>
                            <div id="hotelBuildingParamsContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease;">
                                <div style="padding: 20px;">
                                    <p style="color: var(--umgc-text-light); margin-bottom: 20px; font-size: 0.9rem;">Hotel Building - Guest Accommodations and Services</p>
                                    
                                    <!-- Hotel Building Floors -->
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 1 GSF</span>
                                                <span class="slider-value" id="hotelFloor1Value">25,000</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor1Slider" min="15000" max="40000" value="25000" step="1000" oninput="updateHotelFloor(1, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="hotelFloor1EffValue">75%</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor1EffSlider" min="60" max="95" value="75" step="1" oninput="updateHotelFloorEfficiency(1, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="hotelFloor1Assignable">18,750</span></span>
                                            </div>
                                        </div>
                                        
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 2 GSF</span>
                                                <span class="slider-value" id="hotelFloor2Value">25,000</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor2Slider" min="15000" max="40000" value="25000" step="1000" oninput="updateHotelFloor(2, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="hotelFloor2EffValue">75%</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor2EffSlider" min="60" max="95" value="75" step="1" oninput="updateHotelFloorEfficiency(2, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="hotelFloor2Assignable">18,750</span></span>
                                            </div>
                                        </div>
                                        
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 3 GSF</span>
                                                <span class="slider-value" id="hotelFloor3Value">25,000</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor3Slider" min="15000" max="40000" value="25000" step="1000" oninput="updateHotelFloor(3, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="hotelFloor3EffValue">75%</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor3EffSlider" min="60" max="95" value="75" step="1" oninput="updateHotelFloorEfficiency(3, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="hotelFloor3Assignable">18,750</span></span>
                                            </div>
                                        </div>
                                        
                                        <div class="slider-container">
                                            <div class="slider-header">
                                                <span class="slider-label">Floor 4 GSF</span>
                                                <span class="slider-value" id="hotelFloor4Value">25,000</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor4Slider" min="15000" max="40000" value="25000" step="1000" oninput="updateHotelFloor(4, this.value)">
                                            <div class="slider-header">
                                                <span class="slider-label">Efficiency</span>
                                                <span class="slider-value" id="hotelFloor4EffValue">75%</span>
                                            </div>
                                            <input type="range" class="slider" id="hotelFloor4EffSlider" min="60" max="95" value="75" step="1" oninput="updateHotelFloorEfficiency(4, this.value)">
                                            <div style="margin-top: 8px; padding: 8px; background: var(--umgc-gray-light); border-radius: 4px; text-align: center;">
                                                <span style="font-size: 0.85rem; color: var(--umgc-navy); font-weight: 600;">Assignable SF: <span id="hotelFloor4Assignable">18,750</span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hotel Space Allocation -->
                        <div class="space-card">
                            <div class="collapsible-header" style="padding: 15px 20px; background: linear-gradient(135deg, var(--umgc-red) 0%, #dc2626 100%); border-radius: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
                                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                        <h3 style="color: white; margin: 0; font-size: 1.1rem; font-weight: 600; cursor: pointer;" onclick="toggleHotelSpaceAllocation()">Hotel Space Allocation</h3>
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px;">
                                            <input type="checkbox" id="hotelShowExistingToggle" onchange="toggleHotelExistingData()" checked style="cursor: pointer;">
                                            <span style="color: white; font-size: 0.85rem; font-weight: 600;">Show Existing</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px;">
                                            <input type="checkbox" id="hotelAssignByFloorToggle" onchange="toggleHotelFloorAssignment()" style="cursor: pointer;">
                                            <span style="color: white; font-size: 0.85rem; font-weight: 600;">Assign by Floor</span>
                                        </label>
                                    </div>
                                    <div style="display: flex; gap: 25px; align-items: center; flex: 1; justify-content: flex-end;">
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Total Assigned</div>
                                            <div id="hotelTotalAssignedSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Office</div>
                                            <div id="hotelTotalOfficeSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Collaboration</div>
                                            <div id="hotelTotalCollabSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: white; font-size: 0.75rem; margin-bottom: 2px;">Other</div>
                                            <div id="hotelTotalOtherSF" style="color: white; font-size: 1.1rem; font-weight: 700;">0</div>
                                        </div>
                                    </div>
                                    <span id="hotelSpaceAllocationToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s ease;">â–¼</span>
                                </div>
                            </div>
                            <div id="hotelSpaceAllocationContent" style="max-height: 2000px; overflow: hidden; transition: max-height 0.3s ease;">
                                <div style="padding: 20px;">
                                    <p style="color: var(--umgc-text-light); margin-bottom: 20px; font-size: 0.9rem;">Hotel Building - Guest Rooms, Meeting Spaces, and Services</p>
                                    
                                    <!-- Workstation Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleHotelCategory('workstation')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(217, 91%, 60%) 0%, hsl(217, 91%, 70%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Workstations</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="hotelWorkstationCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="hotelWorkstationSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="hotelWorkstationToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="hotelWorkstationContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="hotelWorkstationSpacesGrid">
                                                <!-- Workstation space types will be dynamically generated -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Office Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleHotelCategory('office')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(142, 76%, 36%) 0%, hsl(142, 76%, 46%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Office Spaces</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="hotelOfficeCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="hotelOfficeSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="hotelOfficeToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="hotelOfficeContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="hotelOfficeSpacesGrid">
                                                <!-- Office space types will be dynamically generated -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Collaboration Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleHotelCategory('collab')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(280, 65%, 60%) 0%, hsl(280, 65%, 70%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Collaboration Spaces</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="hotelCollabCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="hotelCollabSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="hotelCollabToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="hotelCollabContent" style="max-height: 1000px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="hotelCollabSpacesGrid">
                                                <!-- Collaboration space types will be dynamically generated -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Other Spaces -->
                                    <div style="margin-bottom: 25px;">
                                        <div class="category-header" onclick="toggleHotelCategory('other')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: linear-gradient(135deg, hsl(45, 93%, 47%) 0%, hsl(45, 93%, 57%) 100%); border-radius: 6px; margin-bottom: 15px;">
                                            <div style="display: flex; align-items: center; gap: 15px;">
                                                <h4 style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Other Spaces</h4>
                                                <div style="display: flex; gap: 12px; font-size: 0.9rem;">
                                                    <span id="hotelOtherCount" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 spaces</span>
                                                    <span id="hotelOtherSubtotal" style="color: rgba(255,255,255,0.9); font-weight: 600;">0 SF</span>
                                                </div>
                                            </div>
                                            <span id="hotelOtherToggle" style="color: white; font-size: 1.2rem; transition: transform 0.3s;">â–¼</span>
                                        </div>
                                        <div id="hotelOtherContent" style="max-height: 1500px; overflow: hidden; transition: max-height 0.4s ease;">
                                            <div class="space-types-grid" id="hotelOtherSpacesGrid">
                                                <!-- Other space types will be dynamically generated -->
                                            </div>
                                            
                                            <!-- Custom Space Input -->
                                            <div style="margin-top: 20px; padding: 15px; background: var(--umgc-gray-light); border-radius: 8px;">
                                                <h5 style="color: var(--umgc-navy); font-size: 0.9rem; font-weight: 600; margin-bottom: 10px;">Add Custom Space</h5>
                                                <div class="custom-space-inputs">
                                                    <div class="custom-input-group">
                                                        <label class="custom-label">Space Name</label>
                                                        <input type="text" class="custom-input" id="hotelCustomName" placeholder="e.g., Storage Room">
                                                    </div>
                                                    <div class="custom-input-group">
                                                        <label class="custom-label">Square Feet</label>
                                                        <input type="number" class="custom-input" id="hotelCustomSF" placeholder="e.g., 200">
                                                    </div>
                                                    <div class="custom-input-group">
                                                        <label class="custom-label">Qty</label>
                                                        <input type="number" class="custom-input" id="hotelCustomQty" placeholder="e.g., 2">
                                                    </div>
                                                    <div class="custom-input-group">
                                                        <button class="add-space-button" onclick="addHotelCustomSpace()">
                                                            âž• Add Space
                                                        </button>
                                                    </div>
                                                </div>
                                                <div id="hotelCustomSpacesList" class="custom-spaces-list" style="margin-top: 15px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Adelphi Campus Content -->
                <div id="comparison-building-content" class="building-content" style="display: none;">
                    <div class="space-planning-container">
                        <div class="space-title">
                            <h2>Adelphi Campus - Building Portfolio Summary</h2>
                        </div>
                        
                        <div class="building-comparison">
                            <div class="building-summary-grid">
                                <div class="building-summary-card admin">
                                    <div class="building-header">
                                        <h3><img src="adminbuilding.jpg" alt="Admin Building" style="width: 32px; height: 32px; object-fit: cover; border-radius: 4px; vertical-align: middle; margin-right: 8px;"> Admin Building</h3>
                                        <div class="building-status">Active</div>
                                    </div>
                                    <div class="building-metrics">
                                        <div class="metric">
                                            <span class="metric-label">Total GSF</span>
                                            <span class="metric-value" id="adminTotalGSF">80,000</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Assignable SF</span>
                                            <span class="metric-value" id="adminAssignableSF">68,000</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Used SF</span>
                                            <span class="metric-value" id="adminUsedSF">8,685</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Efficiency</span>
                                            <span class="metric-value" id="adminEfficiency">85%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="building-summary-card icc">
                                    <div class="building-header">
                                        <h3><img src="ICC.jpg" alt="ICC Building" style="width: 32px; height: 32px; object-fit: cover; border-radius: 4px; vertical-align: middle; margin-right: 8px;"> ICC Building</h3>
                                        <div class="building-status">Active</div>
                                    </div>
                                    <div class="building-metrics">
                                        <div class="metric">
                                            <span class="metric-label">Total GSF</span>
                                            <span class="metric-value" id="iccTotalGSF">30,000</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Assignable SF</span>
                                            <span class="metric-value" id="iccAssignableSF">24,000</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Used SF</span>
                                            <span class="metric-value" id="iccUsedSF">0</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Efficiency</span>
                                            <span class="metric-value" id="iccEfficiency">80%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="building-summary-card hotel">
                                    <div class="building-header">
                                        <h3><img src="hotel.jpg" alt="Hotel Building" style="width: 32px; height: 32px; object-fit: cover; border-radius: 4px; vertical-align: middle; margin-right: 8px;"> Hotel Building</h3>
                                        <div class="building-status">Active</div>
                                    </div>
                                    <div class="building-metrics">
                                        <div class="metric">
                                            <span class="metric-label">Total GSF</span>
                                            <span class="metric-value" id="hotelTotalGSF">50,000</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Assignable SF</span>
                                            <span class="metric-value" id="hotelAssignableSF">37,500</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Used SF</span>
                                            <span class="metric-value" id="hotelUsedSF">0</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Efficiency</span>
                                            <span class="metric-value" id="hotelEfficiency">75%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="building-summary-card combined">
                                    <div class="building-header">
                                        <h3><img src="adelphicampus.png" alt="Adelphi Campus" style="width: 32px; height: 32px; object-fit: cover; border-radius: 4px; vertical-align: middle; margin-right: 8px;"> Adelphi Campus Total</h3>
                                        <div class="building-status">Total</div>
                                    </div>
                                    <div class="building-metrics">
                                        <div class="metric">
                                            <span class="metric-label">Total GSF</span>
                                            <span class="metric-value" id="combinedTotalGSF">160,000</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Assignable SF</span>
                                            <span class="metric-value" id="combinedAssignableSF">129,500</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Used SF</span>
                                            <span class="metric-value" id="combinedUsedSF">8,685</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">Overall Efficiency</span>
                                            <span class="metric-value" id="combinedEfficiency">81%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                <!-- End building content wrapper -->
            </div>
            <!-- END Dashboard 1 -->

            <!-- Commuter Analysis Content -->
            <div id="dashboard2" class="tab-content">
                <div class="commute-analysis-container">
                    <!-- Header Section -->
                    <div class="commute-header">
                        <h2 class="commute-title">Employee Commute Analysis</h2>
                        <div class="commute-info-box">
                            <p class="commute-info-text">Analyzing 749 people assigned to the Adelphi Campus</p>
                </div>
                        <p class="commute-subtitle">Insights on Travel Times by Car, Public Transport, and Direct Distance</p>
                    </div>

                    <!-- Interactive Filters -->
                    <div class="filter-tabs">
                        <button class="filter-tab active" id="timeTab" onclick="switchFilterTab('time')">
                            <span>â°</span> Filter by Time
                        </button>
                        <button class="filter-tab" id="distanceTab" onclick="switchFilterTab('distance')">
                            <span>ðŸ“</span> Filter by Distance
                        </button>
                    </div>

                    <!-- Time Filter Content -->
                    <div id="timeFilter" class="filter-content active">
                        <div class="filter-card">
                            <h3 class="filter-card-title"><span>â°</span> Travel Time Analysis</h3>
                            <p class="filter-card-desc">Adjust the slider to see how many people are within different travel time thresholds</p>
                            
                            <div class="slider-container">
                                <div class="slider-header">
                                    <label class="slider-label">Maximum Travel Time</label>
                                    <span class="slider-value" id="timeValue">60 minutes</span>
                                </div>
                                <input type="range" class="slider" id="timeSlider" min="0" max="120" value="60" step="5" oninput="updateTimeThreshold(this.value)">
                            </div>

                            <div class="stats-grid">
                                <div class="stat-card stat-card-blue">
                                    <div class="stat-header">
                                        <span class="stat-icon">ðŸš—</span>
                                        <h4 class="stat-title">By Car</h4>
                                    </div>
                                    <div class="stat-value" id="carTimeCount">0</div>
                                    <p class="stat-desc">people within <span id="timeThresholdText">60</span> minutes</p>
                                </div>

                                <div class="stat-card stat-card-green">
                                    <div class="stat-header">
                                        <span class="stat-icon">ðŸšŠ</span>
                                        <h4 class="stat-title">By Public Transport</h4>
                                    </div>
                                    <div class="stat-value" id="transitTimeCount">0</div>
                                    <p class="stat-desc">people within <span id="timeThresholdText2">60</span> minutes</p>
                                    <p class="stat-warning" id="noTransitWarning"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Distance Filter Content -->
                    <div id="distanceFilter" class="filter-content">
                        <div class="filter-card">
                            <h3 class="filter-card-title"><span>ðŸ“</span> Distance Analysis</h3>
                            <p class="filter-card-desc">Adjust the slider to see how many people are within different distance thresholds</p>
                            
                            <div class="slider-container">
                                <div class="slider-header">
                                    <label class="slider-label">Maximum Distance</label>
                                    <span class="slider-value" id="distanceValue">25 miles</span>
                                </div>
                                <input type="range" class="slider" id="distanceSlider" min="5" max="100" value="25" step="5" oninput="updateDistanceThreshold(this.value)">
                            </div>

                            <div class="stats-grid">
                                <div class="stat-card stat-card-blue">
                                    <div class="stat-header">
                                        <span class="stat-icon">ðŸš—</span>
                                        <h4 class="stat-title">By Car Route</h4>
                                    </div>
                                    <div class="stat-value" id="carDistanceCount">0</div>
                                    <p class="stat-desc">people within <span id="distanceThresholdText">25</span> miles</p>
                                </div>

                                <div class="stat-card stat-card-purple">
                                    <div class="stat-header">
                                        <span class="stat-icon">ðŸ§­</span>
                                        <h4 class="stat-title">As Crow Flies</h4>
                                    </div>
                                    <div class="stat-value" id="crowFliesCount">0</div>
                                    <p class="stat-desc">people within <span id="distanceThresholdText2">25</span> miles</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Map Placeholder -->
                    <div class="map-card">
                        <div class="map-header">
                            <div>
                                <h3 class="map-title"><span>ðŸ—ºï¸</span> Employee Locations</h3>
                                <p class="map-subtitle">Geographic distribution of employees based on their zipcode locations</p>
                                <div class="map-legend">
                                    <div class="legend-item">
                                        <div class="legend-color legend-green"></div>
                                        <span>Within threshold</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color legend-gray"></div>
                                        <span>Outside threshold</span>
                                    </div>
                                    <span class="legend-note">â€¢ Marker size = number of people</span>
                                </div>
                        </div>
                    </div>
                    <div id="mapWrapper" class="map-container">
                        <button class="fullscreen-button" onclick="toggleMapFullscreen()" id="fullscreenBtn">â¤¢ Fullscreen</button>
                        <div id="map" style="width: 100%; height: 100%;"></div>
                    </div>
                    <div class="map-stats">
                            <div class="map-stat">
                                <div class="map-stat-value" id="totalZipcodes">0</div>
                                <div class="map-stat-label">Total Zipcodes</div>
                            </div>
                            <div class="map-stat">
                                <div class="map-stat-value map-stat-green" id="zipcodesInThreshold">0</div>
                                <div class="map-stat-label">Within Threshold</div>
                            </div>
                            <div class="map-stat">
                                <div class="map-stat-value" id="totalPeople">0</div>
                                <div class="map-stat-label">Total People</div>
                            </div>
                            <div class="map-stat">
                                <div class="map-stat-value map-stat-green" id="peopleInThreshold">0</div>
                                <div class="map-stat-label">People in Threshold</div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart Section -->
                    <div class="chart-card">
                        <h3 class="chart-title">Travel Time Distribution</h3>
                        <p class="chart-subtitle">Number of people within different time thresholds</p>
                        <canvas id="travelChart" class="travel-chart"></canvas>
                    </div>

                    <!-- Key Metrics -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">ðŸ“</span>
                                <h4 class="metric-title">Number of Zipcodes</h4>
                            </div>
                            <div class="metric-value" id="metricZipcodes">0</div>
                            <p class="metric-desc">Representing <span id="metricPeople">0</span> people</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">ðŸš—</span>
                                <h4 class="metric-title">Avg Car Time</h4>
                            </div>
                            <div class="metric-value" id="metricCarTime">0 min</div>
                            <p class="metric-desc" id="metricCarDistance">0 miles average distance</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">ðŸšŠ</span>
                                <h4 class="metric-title">Avg Transit Time</h4>
                            </div>
                            <div class="metric-value" id="metricTransitTime">N/A</div>
                            <p class="metric-desc" id="metricNoTransit">0 people have no access</p>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">ðŸ“</span>
                                <h4 class="metric-title">Avg Direct Distance</h4>
                            </div>
                            <div class="metric-value" id="metricDirectDistance">0 miles</div>
                            <p class="metric-desc">As the crow flies</p>
                        </div>
                    </div>

                    <!-- Upload Button -->
                    <div class="upload-section">
                        <button class="upload-button" onclick="document.getElementById('csvUpload').click()">
                            ðŸ“ Upload New CSV Data
                        </button>
                        <input type="file" id="csvUpload" accept=".csv" style="display: none;" onchange="handleFileUpload(event)">
                        <span id="uploadedFileName" class="uploaded-filename"></span>
                    </div>

                    <!-- Alert -->
                    <div class="alert-box">
                        <p>ðŸ“ Note: 2025-08-06 | For 30 employees, zipcode data was not available and they are not included in this analysis.</p>
                    </div>
                </div>
            </div>

            <!-- Existing Conditions (Power BI) Content -->
            <div id="powerbi" class="tab-content active">
                <div id="loading3" class="loading">
                    Loading Power BI Dashboard...
                </div>
                
                <iframe 
                    class="dashboard-iframe"
                    id="powerbi-frame"
                    src="https://app.powerbi.com/reportEmbed?reportId=3f02874f-fe2a-4b19-9502-6fbec6ab4341&autoAuth=true&ctid=42523965-66b8-4e84-8ead-59b4ba83077b&actionBarEnabled=true&bookmarkGuid=9e2cac48-300a-4f1c-9df1-3b26b9545491"
                    title="UMGC Power BI Dashboard"
                    allowfullscreen="true"
                    loading="lazy"
                    onload="hideLoading('loading3')">
                </iframe>
            </div>
        </div>
    </div>

    <div class="footer">
        <p><strong>University of Maryland Global Campus</strong></p>
        <p>Facilities Master Plan 2025</p>
        <p>Empowering Education â€¢ Building Futures â€¢ Serving Globally</p>
        <p>Last updated: <span id="lastUpdated"></span></p>
        <p style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
            <a href="https://www.umgc.edu/" target="_blank">Visit UMGC.edu</a> â€¢ 
            <a href="https://www.umgc.edu/about-umgc/locations" target="_blank">Global Locations</a> â€¢ 
            <a href="https://www.umgc.edu/contact-us" target="_blank">Contact Us</a>
        </p>
    </div>

    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Deactivate all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Activate selected tab button
            const buttonMap = {
                'dashboard1': 'tab1-btn',
                'dashboard2': 'tab2-btn',
                'powerbi': 'tab3-btn'
            };
            document.getElementById(buttonMap[tabName]).classList.add('active');

            // Store active tab in localStorage
            localStorage.setItem('umgc_active_tab', tabName);
        }

        // Hide loading indicator when iframe loads
        function hideLoading(loadingId) {
            const loading = document.getElementById(loadingId);
            if (loading) {
                loading.style.display = 'none';
            }
        }

        // Set last updated timestamp
        document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString();

        // Initialize on page load
        window.addEventListener('load', function() {
            // Always start with powerbi (Existing Conditions) as the landing page
            // Clear any previously stored tab preference
            localStorage.removeItem('umgc_active_tab');
            switchTab('powerbi');
        });

        // Keyboard navigation for tabs
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key >= '1' && e.key <= '3') {
                e.preventDefault();
                const tabs = ['dashboard1', 'dashboard2', 'powerbi'];
                switchTab(tabs[parseInt(e.key) - 1]);
            }
        });

        // ===== COMMUTE ANALYSIS FUNCTIONALITY =====
        
        let commuteData = [];
        let activeFilterTab = 'time';
        let timeThreshold = 60;
        let distanceThreshold = 25;
        let travelChart = null;
        let map = null;
        let markers = [];
        let isMapFullscreen = false;

        // Load data when page loads
        async function loadCommuteData() {
            try {
                const response = await fetch('https://hebbkx1anhila5yf.public.blob.vercel-storage.com/Travel%20Times_Employees_Complete_Analysis_Results-1EbbTKE16GkNZBduF6fz5dH70uwWOM.csv');
                const csvText = await response.text();
                commuteData = parseCSV(csvText);
                console.log('Loaded', commuteData.length, 'records');
                updateAllStats();
                createChart();
                initializeMap();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Initialize Mapbox map
        function initializeMap() {
            if (map || commuteData.length === 0) return;

            mapboxgl.accessToken = 'pk.eyJ1IjoicGF0d2QwNSIsImEiOiJjbTZ2bGVhajIwMTlvMnFwc2owa3BxZHRoIn0.moDNfqMUolnHphdwsIF87w';

            // Filter valid data
            const validData = commuteData.filter(item => 
                item.Latitude && 
                item.Longitude && 
                item.Car_Duration_min > 0 && 
                item.Car_Duration_min <= 90
            );

            if (validData.length === 0) return;

            // Calculate bounds
            const bounds = new mapboxgl.LngLatBounds();
            validData.forEach(item => {
                bounds.extend([item.Longitude, item.Latitude]);
            });

            // Create map
            map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v11',
                bounds: bounds,
                fitBoundsOptions: { padding: 50 }
            });

            // Add navigation controls
            map.addControl(new mapboxgl.NavigationControl(), 'top-left');

            // Add markers when map loads
            map.on('load', function() {
                createMarkers();
            });
        }

        // Create markers for all locations
        function createMarkers() {
            // Remove existing markers
            markers.forEach(marker => marker.remove());
            markers = [];

            const allValidData = commuteData.filter(item => item.Latitude && item.Longitude);
            const kmToMiles = (km) => km * 0.621371;

            allValidData.forEach(item => {
                // Determine if within threshold
                let isWithinThreshold = false;
                
                if (activeFilterTab === 'time') {
                    isWithinThreshold = (item.Car_Duration_min > 0 && item.Car_Duration_min <= timeThreshold) ||
                                       (item.Transit_Duration_min > 0 && item.Transit_Duration_min <= timeThreshold);
                } else {
                    isWithinThreshold = (kmToMiles(item.Car_Distance_km) <= distanceThreshold && item.Car_Distance_km > 0) ||
                                       (kmToMiles(item.Crow_Flies_Distance_km) <= distanceThreshold);
                }

                const isWithin90Min = item.Car_Duration_min > 0 && item.Car_Duration_min <= 90;

                // Create marker element
                const markerEl = document.createElement('div');
                markerEl.className = 'custom-marker';
                const size = Math.max(12, Math.min(24, 12 + item.Number_People_in_Zip * 2));
                markerEl.style.width = `${size}px`;
                markerEl.style.height = `${size}px`;
                markerEl.style.backgroundColor = isWithinThreshold ? '#22c55e' : '#94a3b8';
                markerEl.style.borderRadius = '50%';
                markerEl.style.border = '2px solid white';
                markerEl.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
                markerEl.style.opacity = isWithin90Min ? '1' : '0.3';

                // Create popup
                const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(`
                    <div>
                        <h3>Zipcode: ${item.ZCTA5CE20}</h3>
                        <p><strong>People:</strong> ${item.Number_People_in_Zip}</p>
                        <p><strong>Car Time:</strong> ${item.Car_Duration_min > 0 ? Math.round(item.Car_Duration_min) + ' min' : 'N/A'}</p>
                        <p><strong>Car Distance:</strong> ${item.Car_Distance_km > 0 ? Math.round(kmToMiles(item.Car_Distance_km)) + ' miles' : 'N/A'}</p>
                        <p><strong>Transit Time:</strong> ${item.Transit_Duration_min > 0 ? Math.round(item.Transit_Duration_min) + ' min' : 'N/A'}</p>
                        <p><strong>Direct Distance:</strong> ${Math.round(kmToMiles(item.Crow_Flies_Distance_km))} miles</p>
                        <p><strong>Status:</strong> ${isWithinThreshold ? 'âœ… Within threshold' : 'âŒ Outside threshold'}</p>
                    </div>
                `);

                // Create and add marker
                const marker = new mapboxgl.Marker(markerEl)
                    .setLngLat([item.Longitude, item.Latitude])
                    .setPopup(popup)
                    .addTo(map);

                markers.push(marker);
            });
        }

        // Update marker colors when threshold changes
        function updateMarkerColors() {
            if (!map || markers.length === 0) return;

            const allValidData = commuteData.filter(item => item.Latitude && item.Longitude);
            const kmToMiles = (km) => km * 0.621371;

            markers.forEach((marker, index) => {
                if (allValidData[index]) {
                    const item = allValidData[index];
                    let isWithinThreshold = false;
                    
                    if (activeFilterTab === 'time') {
                        isWithinThreshold = (item.Car_Duration_min > 0 && item.Car_Duration_min <= timeThreshold) ||
                                           (item.Transit_Duration_min > 0 && item.Transit_Duration_min <= timeThreshold);
                    } else {
                        isWithinThreshold = (kmToMiles(item.Car_Distance_km) <= distanceThreshold && item.Car_Distance_km > 0) ||
                                           (kmToMiles(item.Crow_Flies_Distance_km) <= distanceThreshold);
                    }

                    const markerEl = marker.getElement();
                    markerEl.style.backgroundColor = isWithinThreshold ? '#22c55e' : '#94a3b8';
                }
            });
        }

        // Toggle map fullscreen
        function toggleMapFullscreen() {
            const mapWrapper = document.getElementById('mapWrapper');
            const btn = document.getElementById('fullscreenBtn');
            
            isMapFullscreen = !isMapFullscreen;
            
            if (isMapFullscreen) {
                mapWrapper.classList.add('map-fullscreen');
                btn.textContent = 'â¤“ Exit Fullscreen';
            } else {
                mapWrapper.classList.remove('map-fullscreen');
                btn.textContent = 'â¤¢ Fullscreen';
            }
            
            // Resize map after transition
            setTimeout(() => {
                if (map) {
                    map.resize();
                }
            }, 100);
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',');
            
            return lines.slice(1)
                .filter(line => line.trim())
                .map(line => {
                    const values = line.split(',');
                    return {
                        ZCTA5CE20: values[0] || '',
                        Latitude: parseFloat(values[1]) || 0,
                        Longitude: parseFloat(values[2]) || 0,
                        Crow_Flies_Distance_km: parseFloat(values[3]) || 0,
                        Car_Distance_km: parseFloat(values[4]) || 0,
                        Car_Duration_min: parseFloat(values[5]) || 0,
                        Car_Error: values[6] === 'null' || !values[6] ? null : values[6],
                        Transit_Distance_km: parseFloat(values[7]) || 0,
                        Transit_Duration_min: parseFloat(values[8]) || 0,
                        Transit_Error: values[9] === 'null' || !values[9] ? null : values[9],
                        Number_People_in_Zip: parseInt(values[10]) || 0
                    };
                });
        }

        // Switch filter tabs (time/distance)
        function switchFilterTab(tab) {
            activeFilterTab = tab;
            
            // Update tab buttons
            document.getElementById('timeTab').classList.toggle('active', tab === 'time');
            document.getElementById('distanceTab').classList.toggle('active', tab === 'distance');
            
            // Update content
            document.getElementById('timeFilter').classList.toggle('active', tab === 'time');
            document.getElementById('distanceFilter').classList.toggle('active', tab === 'distance');
            
            updateAllStats();
        }

        // Update time threshold
        function updateTimeThreshold(value) {
            timeThreshold = parseInt(value);
            document.getElementById('timeValue').textContent = value + ' minutes';
            document.getElementById('timeThresholdText').textContent = value;
            document.getElementById('timeThresholdText2').textContent = value;
            updateAllStats();
        }

        // Update distance threshold
        function updateDistanceThreshold(value) {
            distanceThreshold = parseInt(value);
            document.getElementById('distanceValue').textContent = value + ' miles';
            document.getElementById('distanceThresholdText').textContent = value;
            document.getElementById('distanceThresholdText2').textContent = value;
            updateAllStats();
        }

        // Update all statistics
        function updateAllStats() {
            updateThresholdStats();
            updateDynamicMetrics();
            updateMapStats();
            updateMarkerColors();
        }

        // Update threshold-specific stats
        function updateThresholdStats() {
            const kmToMiles = (km) => km * 0.621371;
            
            if (activeFilterTab === 'time') {
                const carWithinThreshold = commuteData
                    .filter(item => item.Car_Duration_min <= timeThreshold && item.Car_Duration_min > 0)
                    .reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
                
                const transitWithinThreshold = commuteData
                    .filter(item => item.Transit_Duration_min <= timeThreshold && item.Transit_Duration_min > 0)
                    .reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
                
                const noTransitAccess = commuteData
                    .filter(item => item.Transit_Error === 'No route found' || item.Transit_Duration_min === 0)
                    .reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
                
                document.getElementById('carTimeCount').textContent = carWithinThreshold;
                document.getElementById('transitTimeCount').textContent = transitWithinThreshold;
                
                const warningEl = document.getElementById('noTransitWarning');
                if (noTransitAccess > 0) {
                    warningEl.textContent = `${noTransitAccess} people have no transit access`;
                } else {
                    warningEl.textContent = '';
                }
            } else {
                const carWithinDistance = commuteData
                    .filter(item => kmToMiles(item.Car_Distance_km) <= distanceThreshold && item.Car_Distance_km > 0)
                    .reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
                
                const crowFliesWithinDistance = commuteData
                    .filter(item => kmToMiles(item.Crow_Flies_Distance_km) <= distanceThreshold)
                    .reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
                
                document.getElementById('carDistanceCount').textContent = carWithinDistance;
                document.getElementById('crowFliesCount').textContent = crowFliesWithinDistance;
            }
        }

        // Update dynamic metrics
        function updateDynamicMetrics() {
            const kmToMiles = (km) => km * 0.621371;
            
            let filteredData = [];
            
            if (activeFilterTab === 'time') {
                filteredData = commuteData.filter(item => 
                    item.Car_Duration_min <= timeThreshold && item.Car_Duration_min > 0
                );
            } else {
                filteredData = commuteData.filter(item => 
                    kmToMiles(item.Crow_Flies_Distance_km) <= distanceThreshold
                );
            }
            
            const totalZipcodes = filteredData.length;
            const totalPeople = filteredData.reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
            
            // Car stats
            const carData = filteredData.filter(item => item.Car_Duration_min > 0);
            const avgCarTime = carData.length > 0 
                ? Math.round(carData.reduce((sum, item) => sum + item.Car_Duration_min, 0) / carData.length)
                : 0;
            const avgCarDistance = carData.length > 0
                ? kmToMiles(carData.reduce((sum, item) => sum + item.Car_Distance_km, 0) / carData.length)
                : 0;
            
            // Transit stats
            const transitData = filteredData.filter(item => item.Transit_Duration_min > 0);
            const avgTransitTime = transitData.length > 0
                ? Math.round(transitData.reduce((sum, item) => sum + item.Transit_Duration_min, 0) / transitData.length)
                : 0;
            const noTransitAccess = filteredData
                .filter(item => item.Transit_Error === 'No route found' || item.Transit_Duration_min === 0)
                .reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
            
            // Direct distance
            const avgDirectDistance = filteredData.length > 0
                ? kmToMiles(filteredData.reduce((sum, item) => sum + item.Crow_Flies_Distance_km, 0) / filteredData.length)
                : 0;
            
            // Update UI
            document.getElementById('metricZipcodes').textContent = totalZipcodes;
            document.getElementById('metricPeople').textContent = totalPeople;
            document.getElementById('metricCarTime').textContent = avgCarTime + ' min';
            document.getElementById('metricCarDistance').textContent = Math.round(avgCarDistance * 10) / 10 + ' miles average distance';
            document.getElementById('metricTransitTime').textContent = avgTransitTime > 0 ? avgTransitTime + ' min' : 'N/A';
            document.getElementById('metricNoTransit').textContent = noTransitAccess + ' people have no access';
            document.getElementById('metricDirectDistance').textContent = Math.round(avgDirectDistance * 10) / 10 + ' miles';
        }

        // Update map statistics
        function updateMapStats() {
            const kmToMiles = (km) => km * 0.621371;
            
            let filteredData = [];
            
            if (activeFilterTab === 'time') {
                filteredData = commuteData.filter(item =>
                    item.Car_Duration_min <= timeThreshold ||
                    (item.Transit_Duration_min > 0 && item.Transit_Duration_min <= timeThreshold)
                );
            } else {
                filteredData = commuteData.filter(item =>
                    kmToMiles(item.Car_Distance_km) <= distanceThreshold ||
                    kmToMiles(item.Crow_Flies_Distance_km) <= distanceThreshold
                );
            }
            
            const validData = commuteData.filter(item => item.Latitude && item.Longitude);
            const withinThreshold = validData.filter(item =>
                filteredData.some(filtered => filtered.ZCTA5CE20 === item.ZCTA5CE20)
            );
            
            const totalPeople = validData.reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
            const peopleInThreshold = withinThreshold.reduce((sum, item) => sum + item.Number_People_in_Zip, 0);
            
            document.getElementById('totalZipcodes').textContent = validData.length;
            document.getElementById('zipcodesInThreshold').textContent = withinThreshold.length;
            document.getElementById('totalPeople').textContent = totalPeople;
            document.getElementById('peopleInThreshold').textContent = peopleInThreshold;
        }

        // Create chart
        function createChart() {
            const ctx = document.getElementById('travelChart');
            if (!ctx) return;
            
            const chartData = [5, 10, 15, 30, 45, 60].map(minutes => ({
                time: minutes + ' min',
                car: commuteData
                    .filter(item => item.Car_Duration_min <= minutes && item.Car_Duration_min > 0)
                    .reduce((sum, item) => sum + item.Number_People_in_Zip, 0),
                transit: commuteData
                    .filter(item => item.Transit_Duration_min <= minutes && item.Transit_Duration_min > 0)
                    .reduce((sum, item) => sum + item.Number_People_in_Zip, 0)
            }));
            
            if (travelChart) {
                travelChart.destroy();
            }
            
            travelChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(d => d.time),
                    datasets: [
                        {
                            label: 'By Car',
                            data: chartData.map(d => d.car),
                            backgroundColor: '#3b82f6',
                            borderColor: '#2563eb',
                            borderWidth: 1
                        },
                        {
                            label: 'By Transit',
                            data: chartData.map(d => d.transit),
                            backgroundColor: '#10b981',
                            borderColor: '#059669',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of People'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Travel Time Threshold'
                            }
                        }
                    }
                }
            });
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('Please upload a CSV file');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = (e) => {
                try {
                    const csvText = e.target.result;
                    commuteData = parseCSV(csvText);
                    document.getElementById('uploadedFileName').textContent = file.name;
                    console.log('Successfully loaded', commuteData.length, 'records from uploaded file');
                    updateAllStats();
                    createChart();
                    
                    // Recreate map with new data
                    if (map) {
                        map.remove();
                        map = null;
                        markers = [];
                        initializeMap();
                    }
                } catch (error) {
                    console.error('Error parsing uploaded CSV:', error);
                    alert('Error parsing CSV file. Please check the format.');
                }
            };
            
            reader.readAsText(file);
        }

        // Initialize commute analysis when Dashboard 2 is shown
        function initCommuteAnalysis() {
            if (commuteData.length === 0) {
                loadCommuteData();
            }
        }

        // Override switchTab to initialize commute analysis when Dashboard 2 is selected
        const originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            originalSwitchTab(tabName);
            if (tabName === 'dashboard2') {
                initCommuteAnalysis();
            } else if (tabName === 'dashboard1') {
                initSpacePlanning();
            }
        };

        // ===== SPACE PLANNING FUNCTIONALITY =====
        
        const SPACE_TYPES = [
            { id: "workstation", name: "Workstation", defaultSf: 50, category: "workstations", color: "hsl(217, 91%, 60%)", seats: 0 },
            { id: "smallOffice", name: "Small Office", defaultSf: 100, category: "offices", color: "hsl(142, 76%, 36%)", seats: 0 },
            { id: "medOffice", name: "Medium Office", defaultSf: 120, category: "offices", color: "hsl(142, 76%, 46%)", seats: 0 },
            { id: "largeOffice", name: "Large Office", defaultSf: 150, category: "offices", color: "hsl(142, 76%, 56%)", seats: 0 },
            { id: "phoneRoom", name: "Phone Room", defaultSf: 75, category: "support", color: "hsl(280, 65%, 60%)", seats: 1 },
            { id: "huddleRoom", name: "Huddle/Interview Room (2p)", defaultSf: 150, category: "meeting", color: "hsl(47, 96%, 53%)", seats: 2 },
            { id: "smallMeeting", name: "Small Meeting Room (6p)", defaultSf: 250, category: "meeting", color: "hsl(47, 96%, 63%)", seats: 6 },
            { id: "mediumMeeting", name: "Medium Meeting Room (12p)", defaultSf: 400, category: "meeting", color: "hsl(47, 96%, 73%)", seats: 12 },
            { id: "largeMeeting", name: "Large Meeting Room (16p)", defaultSf: 500, category: "meeting", color: "hsl(47, 96%, 83%)", seats: 16 },
            { id: "collaboration", name: "Informal Collaboration (6p)", defaultSf: 300, category: "support", color: "hsl(280, 65%, 70%)", seats: 6 }
        ];

        const CATEGORY_NAMES = {
            workstations: "Workstations",
            offices: "Offices",
            meeting: "Meeting Rooms",
            support: "Support Spaces"
        };

        const CATEGORY_COLORS = {
            workstations: "hsl(217, 91%, 60%)",
            offices: "hsl(142, 76%, 36%)",
            meeting: "hsl(47, 96%, 53%)",
            support: "hsl(280, 65%, 60%)"
        };

        let spaceInitialized = false;
        let floorSpaces = [20000, 20000, 20000, 20000]; // 4 floors for Admin Building
        let floorEfficiencies = [85, 85, 85, 85]; // Efficiency for each floor
        let spaceSF = {};
        let iccSpaceSF = {};
        let hotelSpaceSF = {};
        let quantities = {
            workstation: 50,
            smallOffice: 10,
            medOffice: 8,
            largeOffice: 5,
            phoneRoom: 3,
            huddleRoom: 4,
            smallMeeting: 3,
            mediumMeeting: 2,
            largeMeeting: 1,
            collaboration: 2
        };
        let showExisting = true;
        let assignByFloor = false;
        let floorQuantities = {
            workstation: [0, 0, 0, 0], // Floor 1, 2, 3, 4
            smallOffice: [0, 0, 0, 0],
            medOffice: [0, 0, 0, 0],
            largeOffice: [0, 0, 0, 0],
            phoneRoom: [0, 0, 0, 0],
            huddleRoom: [0, 0, 0, 0],
            smallMeeting: [0, 0, 0, 0],
            mediumMeeting: [0, 0, 0, 0],
            largeMeeting: [0, 0, 0, 0],
            collaboration: [0, 0, 0, 0]
        };
        let existingFloorQuantities = {
            workstation: [10, 10, 10, 10], // Example distribution
            smallOffice: [4, 4, 4, 3],
            medOffice: [2, 2, 2, 1],
            largeOffice: [1, 1, 1, 0],
            phoneRoom: [1, 1, 1, 0],
            huddleRoom: [1, 1, 1, 1],
            smallMeeting: [1, 1, 1, 0],
            mediumMeeting: [1, 1, 1, 0],
            largeMeeting: [1, 0, 0, 0],
            collaboration: [1, 1, 0, 0]
        };

        // ICC Building Data (same space types as Admin)
        let iccQuantities = {
            workstation: 30,
            smallOffice: 10,
            medOffice: 5,
            largeOffice: 2,
            phoneRoom: 2,
            huddleRoom: 3,
            smallMeeting: 2,
            mediumMeeting: 2,
            largeMeeting: 1,
            collaboration: 2
        };

        let iccFloorQuantities = {
            workstation: [0, 0, 0, 0],
            smallOffice: [0, 0, 0, 0],
            medOffice: [0, 0, 0, 0],
            largeOffice: [0, 0, 0, 0],
            phoneRoom: [0, 0, 0, 0],
            huddleRoom: [0, 0, 0, 0],
            smallMeeting: [0, 0, 0, 0],
            mediumMeeting: [0, 0, 0, 0],
            largeMeeting: [0, 0, 0, 0],
            collaboration: [0, 0, 0, 0]
        };

        let iccExistingQuantities = {
            workstation: 25,
            smallOffice: 8,
            medOffice: 4,
            largeOffice: 2,
            phoneRoom: 2,
            huddleRoom: 2,
            smallMeeting: 2,
            mediumMeeting: 1,
            largeMeeting: 1,
            collaboration: 1
        };

        // Hotel Building Data (same space types as Admin)
        let hotelQuantities = {
            workstation: 20,
            smallOffice: 8,
            medOffice: 4,
            largeOffice: 2,
            phoneRoom: 2,
            huddleRoom: 2,
            smallMeeting: 3,
            mediumMeeting: 2,
            largeMeeting: 1,
            collaboration: 1
        };

        let hotelFloorQuantities = {
            workstation: [0, 0, 0, 0],
            smallOffice: [0, 0, 0, 0],
            medOffice: [0, 0, 0, 0],
            largeOffice: [0, 0, 0, 0],
            phoneRoom: [0, 0, 0, 0],
            huddleRoom: [0, 0, 0, 0],
            smallMeeting: [0, 0, 0, 0],
            mediumMeeting: [0, 0, 0, 0],
            largeMeeting: [0, 0, 0, 0],
            collaboration: [0, 0, 0, 0]
        };

        let hotelExistingQuantities = {
            workstation: 18,
            smallOffice: 7,
            medOffice: 3,
            largeOffice: 2,
            phoneRoom: 1,
            huddleRoom: 2,
            smallMeeting: 2,
            mediumMeeting: 2,
            largeMeeting: 1,
            collaboration: 1
        };

        let iccShowExisting = true;
        let iccAssignByFloor = false;
        let hotelShowExisting = true;
        let hotelAssignByFloor = false;

        // ICC Building floor parameters
        let iccFloorSpaces = [15000, 15000, 15000, 15000]; // 4 floors
        let iccFloorEfficiencies = [80, 80, 80, 80]; // 4 floors

        // Hotel Building floor parameters
        let hotelFloorSpaces = [25000, 25000, 25000, 25000]; // 4 floors
        let hotelFloorEfficiencies = [75, 75, 75, 75]; // 4 floors
        let existingQuantities = {
            workstation: 40,
            smallOffice: 15,
            medOffice: 7,
            largeOffice: 3,
            phoneRoom: 3,
            huddleRoom: 4,
            smallMeeting: 3,
            mediumMeeting: 3,
            largeMeeting: 2,
            collaboration: 2
        };
        let customSpaces = [];
        let iccCustomSpaces = [];
        let hotelCustomSpaces = [];
        let categoryChart = null;
        let typeChart = null;
        let alertShown = false;

        // Initialize space SF defaults
        SPACE_TYPES.forEach(type => {
            spaceSF[type.id] = type.defaultSf;
        });

        function initSpacePlanning() {
            if (spaceInitialized) return;
            spaceInitialized = true;
            
            // Initialize Admin Building floor quantities
            SPACE_TYPES.forEach(type => {
                const buildingQty = quantities[type.id] || 0;
                if (buildingQty > 0) {
                    const qtyPerFloor = Math.floor(buildingQty / 4);
                    const remainder = buildingQty % 4;
                    
                    floorQuantities[type.id] = [
                        qtyPerFloor + (remainder > 0 ? 1 : 0),
                        qtyPerFloor + (remainder > 1 ? 1 : 0),
                        qtyPerFloor + (remainder > 2 ? 1 : 0),
                        qtyPerFloor
                    ];
                } else {
                    floorQuantities[type.id] = [0, 0, 0, 0];
                }
            });
            
            // Initialize ICC Building floor quantities (2 floors)
            SPACE_TYPES.forEach(type => {
                const buildingQty = iccQuantities[type.id] || 0;
                if (buildingQty > 0) {
                    const qtyPerFloor = Math.floor(buildingQty / 2);
                    const remainder = buildingQty % 2;
                    
                    iccFloorQuantities[type.id] = [
                        qtyPerFloor + (remainder > 0 ? 1 : 0),
                        qtyPerFloor,
                        0,
                        0
                    ];
                } else {
                    iccFloorQuantities[type.id] = [0, 0, 0, 0];
                }
            });
            
            // Initialize Hotel Building floor quantities (2 floors)
            SPACE_TYPES.forEach(type => {
                const buildingQty = hotelQuantities[type.id] || 0;
                if (buildingQty > 0) {
                    const qtyPerFloor = Math.floor(buildingQty / 2);
                    const remainder = buildingQty % 2;
                    
                    hotelFloorQuantities[type.id] = [
                        qtyPerFloor + (remainder > 0 ? 1 : 0),
                        qtyPerFloor,
                        0,
                        0
                    ];
                } else {
                    hotelFloorQuantities[type.id] = [0, 0, 0, 0];
                }
            });
            
            // Render all buildings
            renderSpaceTypes();
            renderICCSpaceTypes();
            renderHotelSpaceTypes();
            
            updateSpaceCalculations();
            createSpaceCharts();
            
            // Initialize building comparison
            updateBuildingComparison();
        }

        function updateFloor(floorNum, value) {
            // Debug: Find which slider triggered this
            const callerSlider = document.activeElement;
            const adminContent = document.getElementById('admin-building-content');
            console.log('Admin updateFloor called with floor:', floorNum, 'value:', value);
            console.log('Triggered by element ID:', callerSlider.id);
            console.log('Element is visible?', callerSlider.offsetParent !== null);
            console.log('Admin content display:', window.getComputedStyle(adminContent).display);
            console.log('Admin content has active class?', adminContent.classList.contains('active'));
            
            // Only run if Admin building is active
            if (!adminContent.classList.contains('active')) {
                console.log('Admin updateFloor called but Admin building not active, ignoring');
                return;
            }
            
            const floorValue = parseInt(value);
            floorSpaces[floorNum - 1] = floorValue;
            document.getElementById(`floor${floorNum}Value`).textContent = floorValue.toLocaleString();
            
            // Update floor assignable SF
            const assignable = Math.round(floorValue * (floorEfficiencies[floorNum - 1] / 100));
            document.getElementById(`floor${floorNum}Assignable`).textContent = assignable.toLocaleString();
            
            updateBuildingTotals();
            updateSpaceCalculations();
            updateBuildingComparison();
        }

        function updateFloorEfficiency(floorNum, value) {
            // Only run if Admin building is active
            if (!document.getElementById('admin-building-content').classList.contains('active')) {
                console.log('Admin updateFloorEfficiency called but Admin building not active, ignoring');
                return;
            }
            
            const effValue = parseInt(value);
            floorEfficiencies[floorNum - 1] = effValue;
            document.getElementById(`floor${floorNum}EffValue`).textContent = effValue + '%';
            
            // Update floor assignable SF
            const assignable = Math.round(floorSpaces[floorNum - 1] * (effValue / 100));
            document.getElementById(`floor${floorNum}Assignable`).textContent = assignable.toLocaleString();
            
            updateBuildingTotals();
            updateSpaceCalculations();
            updateBuildingComparison();
        }

        function toggleBuildingParams() {
            const content = document.getElementById('buildingParamsContent');
            const toggle = document.getElementById('buildingParamsToggle');
            
            if (content.style.maxHeight === '0px') {
                // Expand
                content.style.maxHeight = '2000px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
            } else {
                // Collapse
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            }
        }

        function toggleComparison() {
            const content = document.getElementById('comparisonContent');
            const toggle = document.getElementById('comparisonToggle');
            
            if (content.style.maxHeight === '0px') {
                // Expand
                content.style.maxHeight = '1000px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
            } else {
                // Collapse
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            }
        }

        function toggleICCComparison() {
            // ICC comparison header doesn't have expandable content, this is just a placeholder for consistency
            const toggle = document.getElementById('iccComparisonToggle');
            if (toggle) {
                // Just animate the toggle icon for visual feedback
                if (toggle.textContent === 'â–¼') {
                    toggle.textContent = 'â–¶';
                } else {
                    toggle.textContent = 'â–¼';
                }
            }
        }

        function toggleHotelComparison() {
            // Hotel comparison header doesn't have expandable content, this is just a placeholder for consistency
            const toggle = document.getElementById('hotelComparisonToggle');
            if (toggle) {
                // Just animate the toggle icon for visual feedback
                if (toggle.textContent === 'â–¼') {
                    toggle.textContent = 'â–¶';
                } else {
                    toggle.textContent = 'â–¼';
                }
            }
        }

        function updateComparison(totalGSF, assignableSF, workstationCount, officeCount, collabCount, collabSeats) {
            // Existing conditions (placeholder data)
            const existingAssignable = 52000;
            const existingWorkstation = 40;
            const existingOffice = 25;
            const existingCollab = 12;
            const existingSeats = 85;
            
            // Update planned values
            document.getElementById('plannedAssignable').textContent = assignableSF.toLocaleString();
            document.getElementById('plannedWorkstation').textContent = workstationCount + (workstationCount === 1 ? ' space' : ' spaces');
            document.getElementById('plannedOffice').textContent = officeCount + (officeCount === 1 ? ' space' : ' spaces');
            document.getElementById('plannedCollab').textContent = collabCount + (collabCount === 1 ? ' space' : ' spaces');
            document.getElementById('plannedSeats').textContent = collabSeats + (collabSeats === 1 ? ' seat' : ' seats');
            
            // Calculate deltas
            const deltaAssignableVal = assignableSF - existingAssignable;
            const deltaWorkstationVal = workstationCount - existingWorkstation;
            const deltaOfficeVal = officeCount - existingOffice;
            const deltaCollabVal = collabCount - existingCollab;
            const deltaSeatVal = collabSeats - existingSeats;
            
            // Format delta values with +/- sign
            const formatDelta = (val) => (val >= 0 ? '+' : '') + val.toLocaleString();
            
            // Update delta values in sticky header (with null checks)
            const deltaGSFEl = document.getElementById('deltaGSF');
            const deltaWorkstationsEl = document.getElementById('deltaWorkstations');
            const deltaOfficesEl = document.getElementById('deltaOffices');
            const deltaSpacesEl = document.getElementById('deltaSpaces');
            const deltaSeatsEl = document.getElementById('deltaSeats');
            
            // Update sticky header values
            if (deltaGSFEl) deltaGSFEl.textContent = formatDelta(deltaAssignableVal);
            if (deltaWorkstationsEl) deltaWorkstationsEl.textContent = formatDelta(deltaWorkstationVal);
            if (deltaOfficesEl) deltaOfficesEl.textContent = formatDelta(deltaOfficeVal);
            if (deltaSpacesEl) deltaSpacesEl.textContent = formatDelta(deltaCollabVal);
            if (deltaSeatsEl) deltaSeatsEl.textContent = formatDelta(deltaSeatVal);
            
            // Also update expanded comparison section if those elements exist
            const deltaAssignableEl = document.getElementById('deltaAssignable');
            const deltaWorkstationEl = document.getElementById('deltaWorkstation');
            const deltaOfficeEl = document.getElementById('deltaOffice');
            const deltaCollabEl = document.getElementById('deltaCollab');
            const deltaSeatCountEl = document.getElementById('deltaSeatCount');
            
            if (deltaAssignableEl) deltaAssignableEl.textContent = formatDelta(deltaAssignableVal);
            if (deltaWorkstationEl) deltaWorkstationEl.textContent = formatDelta(deltaWorkstationVal);
            if (deltaOfficeEl) deltaOfficeEl.textContent = formatDelta(deltaOfficeVal);
            if (deltaCollabEl) deltaCollabEl.textContent = formatDelta(deltaCollabVal);
            if (deltaSeatCountEl) deltaSeatCountEl.textContent = formatDelta(deltaSeatVal);
        }

        function updateBuildingTotals() {
            // Calculate total building GSF
            const totalGSF = floorSpaces.reduce((sum, floor) => sum + floor, 0);
            document.getElementById('totalBuildingGSF').textContent = totalGSF.toLocaleString();
            
            // Calculate total assignable SF
            let totalAssignable = 0;
            for (let i = 0; i < 4; i++) {
                totalAssignable += Math.round(floorSpaces[i] * (floorEfficiencies[i] / 100));
            }
            document.getElementById('totalAssignableSF').textContent = totalAssignable.toLocaleString();
            
            // Calculate overall efficiency
            const overallEff = totalGSF > 0 ? ((totalAssignable / totalGSF) * 100).toFixed(1) : 0;
            document.getElementById('overallEfficiency').textContent = overallEff + '%';
        }

        function updateEfficiency(value) {
            efficiency = parseInt(value);
            document.getElementById('efficiencyValue').textContent = value + '%';
            updateSpaceCalculations();
        }

        function updateSpaceQuantity(id, value) {
            // Only run if Admin building is active
            if (!document.getElementById('admin-building-content').classList.contains('active')) {
                console.log('Admin updateSpaceQuantity called but Admin building not active, ignoring');
                return;
            }
            
            const newQty = parseInt(value);
            quantities[id] = newQty;
            document.getElementById(`qty-${id}`).textContent = value;
            
            // If we're in floor mode, also update floor distribution
            if (assignByFloor) {
                if (newQty > 0) {
                    const qtyPerFloor = Math.floor(newQty / 4);
                    const remainder = newQty % 4;
                    
                    floorQuantities[id] = [
                        qtyPerFloor + (remainder > 0 ? 1 : 0),
                        qtyPerFloor + (remainder > 1 ? 1 : 0),
                        qtyPerFloor + (remainder > 2 ? 1 : 0),
                        qtyPerFloor
                    ];
                } else {
                    floorQuantities[id] = [0, 0, 0, 0];
                }
                // Re-render to update floor inputs
                renderSpaceTypes();
            }
            
            updateSpaceCalculations();
            updateBuildingComparison();
        }

        function updateFloorQuantity(type, floorIndex, value) {
            // Only run if Admin building is active
            if (!document.getElementById('admin-building-content').classList.contains('active')) {
                console.log('Admin updateFloorQuantity called but Admin building not active, ignoring');
                return;
            }
            
            floorQuantities[type][floorIndex] = parseInt(value) || 0;
            // Update the total quantity display
            const total = floorQuantities[type].reduce((a, b) => a + b, 0);
            document.getElementById(`qty-${type}`).textContent = total;
            
            // Also update the building-wide quantity for consistency
            quantities[type] = total;
            
            updateSpaceCalculations();
            updateBuildingComparison();
        }

        function updateSpaceSF(id, value) {
            const numValue = parseInt(value);
            if (!isNaN(numValue) && numValue > 0) {
                spaceSF[id] = numValue;
                updateSpaceCalculations();
                updateBuildingComparison();
            }
        }

        function updateICCSpaceSF(id, value) {
            const numValue = parseInt(value);
            if (!isNaN(numValue) && numValue > 0) {
                iccSpaceSF[id] = numValue;
                updateICCSpaceCalculations();
                updateICCBuildingTotals();
                updateICCCategoryTotals();
                updateBuildingComparison();
            }
        }

        function updateHotelSpaceSF(id, value) {
            const numValue = parseInt(value);
            if (!isNaN(numValue) && numValue > 0) {
                hotelSpaceSF[id] = numValue;
                updateHotelSpaceCalculations();
                updateHotelBuildingTotals();
                updateHotelCategoryTotals();
                updateBuildingComparison();
            }
        }

        // ICC Category Toggle Functions
        function toggleICCCategory(category) {
            const content = document.getElementById(`icc${category.charAt(0).toUpperCase() + category.slice(1)}Content`);
            const toggle = document.getElementById(`icc${category.charAt(0).toUpperCase() + category.slice(1)}Toggle`);
            
            if (content && toggle) {
                const isCollapsed = content.style.maxHeight === '0px';
                content.style.maxHeight = isCollapsed ? '1000px' : '0px';
                toggle.textContent = isCollapsed ? 'â–¼' : 'â–¶';
            }
        }

        // Hotel Category Toggle Functions
        function toggleHotelCategory(category) {
            const content = document.getElementById(`hotel${category.charAt(0).toUpperCase() + category.slice(1)}Content`);
            const toggle = document.getElementById(`hotel${category.charAt(0).toUpperCase() + category.slice(1)}Toggle`);
            
            if (content && toggle) {
                const isCollapsed = content.style.maxHeight === '0px';
                content.style.maxHeight = isCollapsed ? '1000px' : '0px';
                toggle.textContent = isCollapsed ? 'â–¼' : 'â–¶';
            }
        }

        // ICC Category Totals Functions
        function updateICCCategoryTotals() {
            // Workstations
            const workstation = SPACE_TYPES.find(t => t.id === 'workstation');
            if (workstation) {
                const qty = iccQuantities[workstation.id] || 0;
                const sf = qty * (iccSpaceSF[workstation.id] || workstation.defaultSf);
                const countElement = document.getElementById('iccWorkstationCount');
                const subtotalElement = document.getElementById('iccWorkstationSubtotal');
                if (countElement) countElement.textContent = `${qty} spaces`;
                if (subtotalElement) subtotalElement.textContent = `${sf.toLocaleString()} SF`;
            }
            
            // Office Spaces
            const officeSpaces = SPACE_TYPES.filter(t => t.id === 'smallOffice' || t.id === 'medOffice' || t.id === 'largeOffice');
            let officeTotalQty = 0;
            let officeTotalSF = 0;
            officeSpaces.forEach(space => {
                const qty = iccQuantities[space.id] || 0;
                const sf = qty * (iccSpaceSF[space.id] || space.defaultSf);
                officeTotalQty += qty;
                officeTotalSF += sf;
            });
            const officeCountElement = document.getElementById('iccOfficeCount');
            const officeSubtotalElement = document.getElementById('iccOfficeSubtotal');
            if (officeCountElement) officeCountElement.textContent = `${officeTotalQty} spaces`;
            if (officeSubtotalElement) officeSubtotalElement.textContent = `${officeTotalSF.toLocaleString()} SF`;
            
            // Collaboration Spaces
            const collabSpaces = SPACE_TYPES.filter(t => t.category === 'meeting' || t.id === 'collaboration' || t.id === 'phoneRoom');
            let collabTotalQty = 0;
            let collabTotalSF = 0;
            collabSpaces.forEach(space => {
                const qty = iccQuantities[space.id] || 0;
                const sf = qty * (iccSpaceSF[space.id] || space.defaultSf);
                collabTotalQty += qty;
                collabTotalSF += sf;
            });
            const collabCountElement = document.getElementById('iccCollabCount');
            const collabSubtotalElement = document.getElementById('iccCollabSubtotal');
            if (collabCountElement) collabCountElement.textContent = `${collabTotalQty} spaces`;
            if (collabSubtotalElement) collabSubtotalElement.textContent = `${collabTotalSF.toLocaleString()} SF`;
            
            // Other Spaces
            const otherCountElement = document.getElementById('iccOtherCount');
            const otherSubtotalElement = document.getElementById('iccOtherSubtotal');
            if (otherCountElement) otherCountElement.textContent = `0 spaces`;
            if (otherSubtotalElement) otherSubtotalElement.textContent = `0 SF`;
        }

        // Hotel Category Totals Functions
        function updateHotelCategoryTotals() {
            // Workstations
            const workstation = SPACE_TYPES.find(t => t.id === 'workstation');
            if (workstation) {
                const qty = hotelQuantities[workstation.id] || 0;
                const sf = qty * (hotelSpaceSF[workstation.id] || workstation.defaultSf);
                const countElement = document.getElementById('hotelWorkstationCount');
                const subtotalElement = document.getElementById('hotelWorkstationSubtotal');
                if (countElement) countElement.textContent = `${qty} spaces`;
                if (subtotalElement) subtotalElement.textContent = `${sf.toLocaleString()} SF`;
            }
            
            // Office Spaces
            const officeSpaces = SPACE_TYPES.filter(t => t.id === 'smallOffice' || t.id === 'medOffice' || t.id === 'largeOffice');
            let officeTotalQty = 0;
            let officeTotalSF = 0;
            officeSpaces.forEach(space => {
                const qty = hotelQuantities[space.id] || 0;
                const sf = qty * (hotelSpaceSF[space.id] || space.defaultSf);
                officeTotalQty += qty;
                officeTotalSF += sf;
            });
            const officeCountElement = document.getElementById('hotelOfficeCount');
            const officeSubtotalElement = document.getElementById('hotelOfficeSubtotal');
            if (officeCountElement) officeCountElement.textContent = `${officeTotalQty} spaces`;
            if (officeSubtotalElement) officeSubtotalElement.textContent = `${officeTotalSF.toLocaleString()} SF`;
            
            // Collaboration Spaces
            const collabSpaces = SPACE_TYPES.filter(t => t.category === 'meeting' || t.id === 'collaboration' || t.id === 'phoneRoom');
            let collabTotalQty = 0;
            let collabTotalSF = 0;
            collabSpaces.forEach(space => {
                const qty = hotelQuantities[space.id] || 0;
                const sf = qty * (hotelSpaceSF[space.id] || space.defaultSf);
                collabTotalQty += qty;
                collabTotalSF += sf;
            });
            const collabCountElement = document.getElementById('hotelCollabCount');
            const collabSubtotalElement = document.getElementById('hotelCollabSubtotal');
            if (collabCountElement) collabCountElement.textContent = `${collabTotalQty} spaces`;
            if (collabSubtotalElement) collabSubtotalElement.textContent = `${collabTotalSF.toLocaleString()} SF`;
            
            // Other Spaces
            const otherCountElement = document.getElementById('hotelOtherCount');
            const otherSubtotalElement = document.getElementById('hotelOtherSubtotal');
            if (otherCountElement) otherCountElement.textContent = `0 spaces`;
            if (otherSubtotalElement) otherSubtotalElement.textContent = `0 SF`;
        }

        function updateSpaceCalculations() {
            // Calculate totals
            const totalGSF = floorSpaces.reduce((sum, floor) => sum + floor, 0);
            
            // Calculate total assignable SF from all floors
            let assignableSF = 0;
            for (let i = 0; i < 4; i++) {
                assignableSF += Math.round(floorSpaces[i] * (floorEfficiencies[i] / 100));
            }
            
            const overallEfficiency = totalGSF > 0 ? ((assignableSF / totalGSF) * 100).toFixed(1) : 85;
            
            let usedSF = 0;
            SPACE_TYPES.forEach(type => {
                const sf = spaceSF[type.id] || type.defaultSf;
                let qty = 0;
                
                if (assignByFloor) {
                    // Use floor quantities
                    qty = floorQuantities[type.id] ? floorQuantities[type.id].reduce((a, b) => a + b, 0) : 0;
                } else {
                    // Use building-wide quantities
                    qty = quantities[type.id] || 0;
                }
                
                usedSF += sf * qty;
                
                // Update individual space totals
                const totalEl = document.getElementById(`total-${type.id}`);
                if (totalEl) {
                    totalEl.textContent = (sf * qty).toLocaleString() + ' SF';
                }
            });
            
            customSpaces.forEach(space => {
                usedSF += space.sf * space.quantity;
            });
            
            // Calculate category totals for header
            let workstationSF = 0;
            let officeSF = 0;
            let collabSF = 0;
            let otherSF = 0;
            let workstationCount = 0;
            let officeCount = 0;
            let collabCount = 0;
            let collabSeats = 0;
            let otherCount = 0;
            
            SPACE_TYPES.forEach(type => {
                const sf = spaceSF[type.id] || type.defaultSf;
                let qty = 0;
                
                if (assignByFloor) {
                    // Use floor quantities
                    qty = floorQuantities[type.id] ? floorQuantities[type.id].reduce((a, b) => a + b, 0) : 0;
                } else {
                    // Use building-wide quantities
                    qty = quantities[type.id] || 0;
                }
                
                const total = sf * qty;
                
                if (type.id === 'workstation') {
                    workstationSF += total;
                    workstationCount += qty;
                } else if (type.id === 'smallOffice' || type.id === 'medOffice' || type.id === 'largeOffice') {
                    officeSF += total;
                    officeCount += qty;
                } else if (type.category === 'meeting' || type.id === 'collaboration' || type.id === 'phoneRoom') {
                    collabSF += total;
                    collabCount += qty;
                    collabSeats += (type.seats || 0) * qty;
                } else {
                    otherSF += total;
                    otherCount += qty;
                }
            });
            
            // Add custom spaces to "Other"
            customSpaces.forEach(space => {
                otherSF += space.sf * space.quantity;
                otherCount += space.quantity;
            });
            
            // Update space allocation header totals (with null checks for Admin building)
            const totalAssignedSFEl = document.getElementById('totalAssignedSF');
            const totalOfficeSFEl = document.getElementById('totalOfficeSF');
            const totalCollabSFEl = document.getElementById('totalCollabSF');
            const totalOtherSFEl = document.getElementById('totalOtherSF');
            
            if (totalAssignedSFEl) totalAssignedSFEl.textContent = usedSF.toLocaleString();
            if (totalOfficeSFEl) totalOfficeSFEl.textContent = officeSF.toLocaleString();
            if (totalCollabSFEl) totalCollabSFEl.textContent = collabSF.toLocaleString();
            if (totalOtherSFEl) totalOtherSFEl.textContent = otherSF.toLocaleString();
            
            // Update category subtotals (with null checks)
            const workstationCountEl = document.getElementById('workstationCount');
            const workstationSubtotalEl = document.getElementById('workstationSubtotal');
            const officeCountEl = document.getElementById('officeCount');
            const officeSubtotalEl = document.getElementById('officeSubtotal');
            const collabCountEl = document.getElementById('collabCount');
            const collabSeatsEl = document.getElementById('collabSeats');
            const collabSubtotalEl = document.getElementById('collabSubtotal');
            const otherSubtotalEl = document.getElementById('otherSubtotal');
            
            if (workstationCountEl) workstationCountEl.textContent = workstationCount + (workstationCount === 1 ? ' space' : ' spaces');
            if (workstationSubtotalEl) workstationSubtotalEl.textContent = workstationSF.toLocaleString() + ' SF';
            if (officeCountEl) officeCountEl.textContent = officeCount + (officeCount === 1 ? ' space' : ' spaces');
            if (officeSubtotalEl) officeSubtotalEl.textContent = officeSF.toLocaleString() + ' SF';
            if (collabCountEl) collabCountEl.textContent = collabCount + (collabCount === 1 ? ' space' : ' spaces');
            if (collabSeatsEl) collabSeatsEl.textContent = collabSeats + (collabSeats === 1 ? ' seat' : ' seats');
            if (collabSubtotalEl) collabSubtotalEl.textContent = collabSF.toLocaleString() + ' SF';
            if (otherSubtotalEl) otherSubtotalEl.textContent = otherSF.toLocaleString() + ' SF';
            
            // Update comparison
            updateComparison(totalGSF, assignableSF, workstationCount, officeCount, collabCount, collabSeats);
            
            const remainingSF = assignableSF - usedSF;
            const utilizationPercent = (usedSF / assignableSF) * 100;
            
            // Check for over capacity and show alert
            if (remainingSF < 0) {
                // Show alert
                if (!alertShown) {
                    showCapacityAlert(assignableSF, usedSF, remainingSF);
                    alertShown = true;
                }
            } else {
                alertShown = false;
            }
            
            // Update charts and tables
            updateSpaceCharts();
            updateCategorySummary();
            updateDetailedTable();
        }

        function toggleSpaceAllocation() {
            const content = document.getElementById('spaceAllocationContent');
            const toggle = document.getElementById('spaceAllocationToggle');
            
            if (content.style.maxHeight === '0px') {
                // Expand
                content.style.maxHeight = '3000px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
                
                // Initialize space planning when first opened
                initializeSpacePlanning();
                
                // Update charts after a short delay to ensure DOM is ready
                setTimeout(() => {
                    updateSpaceCharts();
                }, 100);
            } else {
                // Collapse
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            }
        }

        function toggleCategory(category) {
            const content = document.getElementById(`${category}Content`);
            const toggle = document.getElementById(`${category}Toggle`);
            
            if (content.style.maxHeight === '0px') {
                // Expand
                if (category === 'workstation') content.style.maxHeight = '500px';
                else if (category === 'office') content.style.maxHeight = '1000px';
                else if (category === 'collab') content.style.maxHeight = '1000px';
                else if (category === 'other') content.style.maxHeight = '1500px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
            } else {
                // Collapse
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            }
        }

        function toggleExistingData() {
            showExisting = document.getElementById('showExistingToggle').checked;
            renderSpaceTypes();
        }

        function switchBuilding(buildingType) {
            console.log('=== SWITCHING TO BUILDING:', buildingType, '===');
            
            // Hide all building contents AGGRESSIVELY
            const allContents = document.querySelectorAll('.building-content');
            console.log('Found building contents:', allContents.length);
            allContents.forEach(content => {
                content.classList.remove('active');
                content.style.cssText = 'display: none !important; visibility: hidden !important; pointer-events: none !important; position: absolute !important; top: -99999px !important; left: -99999px !important; z-index: -9999 !important;';
                console.log('Hiding:', content.id);
            });
            
            // Remove active class from all building tab buttons
            const allButtons = document.querySelectorAll('.building-tab-button');
            allButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected building content AGGRESSIVELY
            const selectedContent = document.getElementById(`${buildingType}-building-content`);
            if (selectedContent) {
                selectedContent.classList.add('active');
                selectedContent.style.cssText = 'display: block !important; visibility: visible !important; pointer-events: auto !important; position: relative !important; top: auto !important; left: auto !important; z-index: 1 !important; opacity: 1 !important;';
                console.log('Showing:', selectedContent.id);
                
                // Update the building title based on the selected building
                const titleElement = selectedContent.querySelector('.space-title h2');
                if (titleElement) {
                    const buildingNames = {
                        'admin': 'Admin Building',
                        'icc': 'ICC Building', 
                        'hotel': 'Hotel Building',
                        'comparison': 'Adelphi Campus'
                    };
                    titleElement.textContent = buildingNames[buildingType] || 'Unknown Building';
                    console.log('Updated title to:', titleElement.textContent);
                }
                
                // Debug: Check what floor values are showing
                const floor1Value = selectedContent.querySelector('[id*="Floor1Value"]');
                if (floor1Value) {
                    console.log('Floor 1 value showing:', floor1Value.textContent);
                }
                
                // Ensure space types are rendered when switching to building
                if (buildingType === 'icc') {
                    renderICCSpaceTypes();
                } else if (buildingType === 'hotel') {
                    renderHotelSpaceTypes();
                }
            } else {
                console.log('ERROR: Could not find content for:', buildingType);
            }
            
            // Add active class to selected button
            const selectedButton = document.getElementById(`${buildingType}-building-btn`);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }

            // Update building comparison when switching
            updateBuildingComparison();
            console.log('=== BUILDING SWITCH COMPLETE ===');
        }

        // Generic function to render space types for any building (DEPRECATED - use individual building functions)
        function renderSpaceTypesForBuilding(buildingType) {
            // This function is no longer used - ICC and Hotel use their own rendering functions
            return '';
        }

        // Helper function to generate HTML for a single space type card
        function generateSpaceTypeCard(type, customQuantities, customFloorQuantities, customAssignByFloor, customShowExisting, updateQuantityFunc, updateFloorQuantityFunc, customSpaceSF, updateSpaceSFFunc, buildingPrefix = '') {
            const existingQty = existingQuantities[type.id] || 0;
            const existingSF = type.defaultSf;
            const existingTotal = existingQty * existingSF;
            const currentQty = customQuantities[type.id] || 0;
            
            if (customAssignByFloor) {
                // Floor-by-floor assignment
                return `
                <div class="space-type-card">
                    <div class="space-type-header">
                        <div class="space-type-name">${type.name}</div>
                        <div class="space-type-color" style="background-color: ${type.color}"></div>
                    </div>
                    ${customShowExisting ? `
                    <div style="margin-bottom: 8px;">
                        <div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">EXISTING</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 4px; font-size: 0.65rem;">
                            <div>
                                <div style="color: var(--umgc-text-light); font-weight: 600;">F1</div>
                                <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][0] || 0}</div>
                            </div>
                            <div>
                                <div style="color: var(--umgc-text-light); font-weight: 600;">F2</div>
                                <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][1] || 0}</div>
                            </div>
                            <div>
                                <div style="color: var(--umgc-text-light); font-weight: 600;">F3</div>
                                <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][2] || 0}</div>
                            </div>
                            <div>
                                <div style="color: var(--umgc-text-light); font-weight: 600;">F4</div>
                                <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][3] || 0}</div>
                            </div>
                        </div>
                        <div style="margin-top: 4px; text-align: center; font-size: 0.65rem; color: var(--umgc-text-light);">
                            Total: ${existingQty} units
                        </div>
                    </div>
                    ` : ''}
                    <div style="margin-bottom: 6px;">
                        ${customShowExisting ? '<div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">PLANNED BY FLOOR</div>' : ''}
                        <div class="space-input-group" style="margin-bottom: 8px;">
                            <label class="space-input-label">SF per Unit</label>
                            <input type="number" class="space-input" value="${customSpaceSF[type.id] || type.defaultSf}" 
                                   onchange="${updateSpaceSFFunc}('${type.id}', this.value)" min="1" style="max-width: 100px; width: 100px;">
                        </div>
                        <div class="space-type-inputs">
                            <div class="space-input-group">
                                <label class="space-input-label">Floor 1</label>
                                <input type="number" class="space-input" value="${customFloorQuantities[type.id][0] || 0}" 
                                       onchange="${updateFloorQuantityFunc}('${type.id}', 0, this.value)" min="0" style="max-width: 60px; width: 60px;">
                            </div>
                            <div class="space-input-group">
                                <label class="space-input-label">Floor 2</label>
                                <input type="number" class="space-input" value="${customFloorQuantities[type.id][1] || 0}" 
                                       onchange="${updateFloorQuantityFunc}('${type.id}', 1, this.value)" min="0" style="max-width: 60px; width: 60px;">
                            </div>
                            <div class="space-input-group">
                                <label class="space-input-label">Floor 3</label>
                                <input type="number" class="space-input" value="${customFloorQuantities[type.id][2] || 0}" 
                                       onchange="${updateFloorQuantityFunc}('${type.id}', 2, this.value)" min="0" style="max-width: 60px; width: 60px;">
                            </div>
                            <div class="space-input-group">
                                <label class="space-input-label">Floor 4</label>
                                <input type="number" class="space-input" value="${customFloorQuantities[type.id][3] || 0}" 
                                       onchange="${updateFloorQuantityFunc}('${type.id}', 3, this.value)" min="0" style="max-width: 60px; width: 60px;">
                            </div>
                        </div>
                        <div style="text-align: center; font-size: 0.75rem; color: var(--umgc-navy); font-weight: 600; margin-top: 4px;">
                            Total: <span id="qty-${type.id}">${customFloorQuantities[type.id].reduce((a, b) => a + b, 0)}</span> units
                        </div>
                        <div class="space-type-total">
                            <span class="space-total-label">Total SF:</span>
                            <span class="space-total-value" id="${buildingPrefix}total-${type.id}">0 SF</span>
                        </div>
                    </div>
                </div>
                `;
            } else {
                // Building-wide assignment
                return `
                <div class="space-type-card">
                    <div class="space-type-header">
                        <div class="space-type-name">${type.name}</div>
                        <div class="space-type-color" style="background-color: ${type.color}"></div>
                    </div>
                    ${customShowExisting ? `
                    <div style="margin-bottom: 8px;">
                        <div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">EXISTING</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 4px; font-size: 0.7rem;">
                            <div>
                                <div style="color: var(--umgc-text-light); font-weight: 600;">Qty</div>
                                <div style="color: var(--umgc-navy); font-weight: 700;">${existingQty}</div>
                            </div>
                            <div>
                                <div style="color: var(--umgc-text-light); font-weight: 600;">SF</div>
                                <div style="color: var(--umgc-navy); font-weight: 700;">${existingSF}</div>
                            </div>
                            <div>
                                <div style="color: var(--umgc-text-light); font-weight: 600;">Total</div>
                                <div style="color: var(--umgc-navy); font-weight: 700;">${existingTotal.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    <div style="margin-bottom: 6px;">
                        ${customShowExisting ? '<div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">PLANNED</div>' : ''}
                        <div class="space-type-inputs">
                            <div class="space-input-group">
                                <label class="space-input-label">SF per Unit</label>
                                <input type="number" class="space-input" value="${customSpaceSF[type.id] || type.defaultSf}" 
                                       onchange="${updateSpaceSFFunc}('${type.id}', this.value)" min="1">
                            </div>
                            <div class="space-input-group" style="flex: 1.5;">
                                <label class="space-input-label">Qty</label>
                                <input type="range" class="slider" min="0" max="100" value="${currentQty}" 
                                       step="1" oninput="${updateQuantityFunc}('${type.id}', this.value)">
                            </div>
                        </div>
                        <div class="space-type-total">
                            <span class="space-total-label">Total SF:</span>
                            <span class="space-total-value" id="${buildingPrefix}total-${type.id}">0 SF</span>
                        </div>
                    </div>
                </div>
                `;
            }
        }

        // ICC Building Functions (render same space types as Admin)
        function renderICCSpaceTypes() {
            // Render Workstations
            const workstationGrid = document.getElementById('iccWorkstationSpacesGrid');
            if (workstationGrid) {
                const workstation = SPACE_TYPES.find(t => t.id === 'workstation');
                if (workstation) {
                    workstationGrid.innerHTML = generateSpaceTypeCard(workstation, iccQuantities, iccFloorQuantities, iccAssignByFloor, iccShowExisting, 'updateICCSpaceQuantity', 'updateICCFloorQuantity', iccSpaceSF, 'updateICCSpaceSF', 'icc-');
                }
            }
            
            // Render Office Spaces
            const officeGrid = document.getElementById('iccOfficeSpacesGrid');
            if (officeGrid) {
                const officeSpaces = SPACE_TYPES.filter(t => t.id === 'smallOffice' || t.id === 'medOffice' || t.id === 'largeOffice');
                let html = '';
                officeSpaces.forEach(space => {
                    html += generateSpaceTypeCard(space, iccQuantities, iccFloorQuantities, iccAssignByFloor, iccShowExisting, 'updateICCSpaceQuantity', 'updateICCFloorQuantity', iccSpaceSF, 'updateICCSpaceSF', 'icc-');
                });
                officeGrid.innerHTML = html;
            }
            
            // Render Collaboration Spaces
            const collabGrid = document.getElementById('iccCollabSpacesGrid');
            if (collabGrid) {
                const collabSpaces = SPACE_TYPES.filter(t => t.category === 'meeting' || t.id === 'collaboration' || t.id === 'phoneRoom');
                let html = '';
                collabSpaces.forEach(space => {
                    html += generateSpaceTypeCard(space, iccQuantities, iccFloorQuantities, iccAssignByFloor, iccShowExisting, 'updateICCSpaceQuantity', 'updateICCFloorQuantity', iccSpaceSF, 'updateICCSpaceSF', 'icc-');
                });
                collabGrid.innerHTML = html;
            }
            
            // Render Other Spaces (empty for now)
            const otherGrid = document.getElementById('iccOtherSpacesGrid');
            if (otherGrid) {
                otherGrid.innerHTML = '';
            }
            
            updateICCBuildingTotals();
            updateICCCategoryTotals();
            updateICCSpaceCalculations();
        }

        function updateICCSpaceCalculations() {
            // Update individual space type totals
            SPACE_TYPES.forEach(type => {
                const sf = iccSpaceSF[type.id] || type.defaultSf;
                let qty = 0;
                
                if (iccAssignByFloor) {
                    // Use floor quantities
                    qty = iccFloorQuantities[type.id] ? iccFloorQuantities[type.id].reduce((a, b) => a + b, 0) : 0;
                } else {
                    // Use building-wide quantities
                    qty = iccQuantities[type.id] || 0;
                }
                
                // Update individual space totals
                const totalEl = document.getElementById(`icc-total-${type.id}`);
                if (totalEl) {
                    totalEl.textContent = (sf * qty).toLocaleString() + ' SF';
                }
            });
        }

        function updateICCSpaceQuantity(id, value) {
            const newQty = parseInt(value);
            iccQuantities[id] = newQty;
            
            if (iccAssignByFloor) {
                if (newQty > 0) {
                    const qtyPerFloor = Math.floor(newQty / 4); // ICC has 4 floors
                    const remainder = newQty % 4;
                    
                    iccFloorQuantities[id] = [
                        qtyPerFloor + (remainder > 0 ? 1 : 0),
                        qtyPerFloor + (remainder > 1 ? 1 : 0),
                        qtyPerFloor + (remainder > 2 ? 1 : 0),
                        qtyPerFloor
                    ];
                } else {
                    iccFloorQuantities[id] = [0, 0, 0, 0];
                }
                renderICCSpaceTypes();
            }
            updateICCSpaceCalculations();
            updateICCBuildingTotals();
            updateICCCategoryTotals();
            updateBuildingComparison();
        }

        function updateICCFloorQuantity(type, floorIndex, value) {
            iccFloorQuantities[type][floorIndex] = parseInt(value) || 0;
            const total = iccFloorQuantities[type].reduce((a, b) => a + b, 0); // All 4 floors
            iccQuantities[type] = total;
            updateICCSpaceCalculations();
            updateICCBuildingTotals();
            updateICCCategoryTotals();
            updateBuildingComparison();
        }

        function updateICCFloor(floorNum, value) {
            console.log('ICC updateICCFloor called with floor:', floorNum, 'value:', value);
            const floorValue = parseInt(value);
            iccFloorSpaces[floorNum - 1] = floorValue;
            document.getElementById(`iccFloor${floorNum}Value`).textContent = floorValue.toLocaleString();
            
            // Update assignable SF based on efficiency
            const efficiency = iccFloorEfficiencies[floorNum - 1] / 100;
            const assignable = Math.round(floorValue * efficiency);
            document.getElementById(`iccFloor${floorNum}Assignable`).textContent = assignable.toLocaleString();
            
            updateICCBuildingTotals();
            updateBuildingComparison();
        }

        function updateICCFloorEfficiency(floorNum, value) {
            const efficiencyValue = parseInt(value);
            iccFloorEfficiencies[floorNum - 1] = efficiencyValue;
            document.getElementById(`iccFloor${floorNum}EffValue`).textContent = efficiencyValue + '%';
            
            // Update assignable SF
            const gsf = iccFloorSpaces[floorNum - 1];
            const assignable = Math.round(gsf * (efficiencyValue / 100));
            document.getElementById(`iccFloor${floorNum}Assignable`).textContent = assignable.toLocaleString();
            
            updateICCBuildingTotals();
            updateBuildingComparison();
        }

        function toggleICCBuildingParams() {
            const content = document.getElementById('iccBuildingParamsContent');
            const toggle = document.getElementById('iccBuildingParamsToggle');
            
            if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            } else {
                content.style.maxHeight = '2000px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        function toggleICCSpaceAllocation() {
            const content = document.getElementById('iccSpaceAllocationContent');
            const toggle = document.getElementById('iccSpaceAllocationToggle');
            
            if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            } else {
                content.style.maxHeight = '3000px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        function toggleICCExistingData() {
            iccShowExisting = document.getElementById('iccShowExistingToggle').checked;
            renderICCSpaceTypes();
        }

        function toggleICCFloorAssignment() {
            const wasFloorMode = iccAssignByFloor;
            iccAssignByFloor = document.getElementById('iccAssignByFloorToggle').checked;
            
            if (iccAssignByFloor && !wasFloorMode) {
                // Switching TO floor mode: distribute building quantities equally across 2 floors
                SPACE_TYPES.forEach(type => {
                    const buildingQty = iccQuantities[type.id] || 0;
                    if (buildingQty > 0) {
                        const qtyPerFloor = Math.floor(buildingQty / 2);
                        const remainder = buildingQty % 2;
                        
                        iccFloorQuantities[type.id] = [
                            qtyPerFloor + (remainder > 0 ? 1 : 0),
                            qtyPerFloor,
                            0,
                            0
                        ];
                    } else {
                        iccFloorQuantities[type.id] = [0, 0, 0, 0];
                    }
                });
            } else if (!iccAssignByFloor && wasFloorMode) {
                // Switching FROM floor mode: sum floor quantities back to building total
                SPACE_TYPES.forEach(type => {
                    const floorTotal = iccFloorQuantities[type.id] ? 
                        iccFloorQuantities[type.id].slice(0, 2).reduce((a, b) => a + b, 0) : 0;
                    iccQuantities[type.id] = floorTotal;
                });
            }
            
            renderICCSpaceTypes();
            updateICCBuildingTotals();
        }

        function toggleICCExistingData() {
            iccShowExisting = document.getElementById('iccShowExistingToggle').checked;
            renderICCSpaceTypes();
        }

        function toggleICCFloorAssignment() {
            const wasFloorMode = iccAssignByFloor;
            iccAssignByFloor = document.getElementById('iccAssignByFloorToggle').checked;
            
            if (iccAssignByFloor && !wasFloorMode) {
                // Switching TO floor mode: distribute building quantities equally across 2 floors
                SPACE_TYPES.forEach(type => {
                    const buildingQty = iccQuantities[type.id] || 0;
                    if (buildingQty > 0) {
                        const qtyPerFloor = Math.floor(buildingQty / 2);
                        const remainder = buildingQty % 2;
                        
                        iccFloorQuantities[type.id] = [
                            qtyPerFloor + (remainder > 0 ? 1 : 0),
                            qtyPerFloor,
                            0,
                            0
                        ];
                    } else {
                        iccFloorQuantities[type.id] = [0, 0, 0, 0];
                    }
                });
            } else if (!iccAssignByFloor && wasFloorMode) {
                // Switching FROM floor mode: sum floor quantities back to building total
                SPACE_TYPES.forEach(type => {
                    const floorTotal = iccFloorQuantities[type.id] ? 
                        iccFloorQuantities[type.id].slice(0, 2).reduce((a, b) => a + b, 0) : 0;
                    iccQuantities[type.id] = floorTotal;
                });
            }
            
            renderICCSpaceTypes();
            updateICCBuildingTotals();
        }

        function updateICCBuildingTotals() {
            // Calculate totals from floor sliders
            const totalGSF = iccFloorSpaces.reduce((a, b) => a + b, 0);
            const totalAssignable = iccFloorSpaces.reduce((sum, gsf, index) => {
                return sum + Math.round(gsf * (iccFloorEfficiencies[index] / 100));
            }, 0);
            const overallEfficiency = totalGSF > 0 ? Math.round((totalAssignable / totalGSF) * 100) : 0;
            
            // Calculate space allocation totals
            let usedSF = 0;
            let workstationCount = 0;
            let officeCount = 0;
            let collabCount = 0;
            let collabSeats = 0;
            let otherCount = 0;
            
            SPACE_TYPES.forEach(type => {
                const qty = iccQuantities[type.id] || 0;
                const sfPerUnit = iccSpaceSF[type.id] || type.defaultSf;
                usedSF += qty * sfPerUnit;
                
                if (type.category === 'workstations') workstationCount += qty;
                if (type.category === 'offices') officeCount += qty;
                if (type.category === 'collaboration') {
                    collabCount += qty;
                    collabSeats += qty * (type.seats || 0);
                }
                if (type.category === 'other') otherCount += qty;
            });
            
            // Add ICC custom spaces
            iccCustomSpaces.forEach(space => {
                usedSF += space.sf * space.quantity;
                otherCount += space.quantity;
            });
            
            document.getElementById('iccTotalAssignedSF').textContent = usedSF.toLocaleString();
            document.getElementById('iccBuildingTotalGSF').textContent = totalGSF.toLocaleString();
            document.getElementById('iccBuildingTotalAssignable').textContent = totalAssignable.toLocaleString();
            document.getElementById('iccBuildingOverallEfficiency').textContent = overallEfficiency + '%';
            
            // Update ICC comparison header
            updateICCComparison(totalGSF, totalAssignable, workstationCount, officeCount, collabCount, collabSeats);
        }

        function updateICCComparison(totalGSF, assignableSF, workstationCount, officeCount, collabCount, collabSeats) {
            // Existing conditions for ICC (placeholder data)
            const existingAssignable = 20000;
            const existingWorkstation = 15;
            const existingOffice = 10;
            const existingCollab = 5;
            const existingSeats = 35;
            
            // Calculate deltas
            const deltaAssignableVal = assignableSF - existingAssignable;
            const deltaWorkstationVal = workstationCount - existingWorkstation;
            const deltaOfficeVal = officeCount - existingOffice;
            const deltaCollabVal = collabCount - existingCollab;
            const deltaSeatVal = collabSeats - existingSeats;
            
            // Format delta values with +/- sign
            const formatDelta = (val) => (val >= 0 ? '+' : '') + val.toLocaleString();
            
            // Update delta values in sticky header
            const deltaGSFEl = document.getElementById('iccDeltaGSF');
            const deltaWorkstationsEl = document.getElementById('iccDeltaWorkstations');
            const deltaOfficesEl = document.getElementById('iccDeltaOffices');
            const deltaSpacesEl = document.getElementById('iccDeltaSpaces');
            const deltaSeatsEl = document.getElementById('iccDeltaSeats');
            
            if (deltaGSFEl) deltaGSFEl.textContent = formatDelta(deltaAssignableVal);
            if (deltaWorkstationsEl) deltaWorkstationsEl.textContent = formatDelta(deltaWorkstationVal);
            if (deltaOfficesEl) deltaOfficesEl.textContent = formatDelta(deltaOfficeVal);
            if (deltaSpacesEl) deltaSpacesEl.textContent = formatDelta(deltaCollabVal);
            if (deltaSeatsEl) deltaSeatsEl.textContent = formatDelta(deltaSeatVal);
        }

        // Hotel Building Functions (render same space types as Admin)
        function renderHotelSpaceTypes() {
            // Render Workstations
            const workstationGrid = document.getElementById('hotelWorkstationSpacesGrid');
            if (workstationGrid) {
                const workstation = SPACE_TYPES.find(t => t.id === 'workstation');
                if (workstation) {
                    workstationGrid.innerHTML = generateSpaceTypeCard(workstation, hotelQuantities, hotelFloorQuantities, hotelAssignByFloor, hotelShowExisting, 'updateHotelSpaceQuantity', 'updateHotelFloorQuantity', hotelSpaceSF, 'updateHotelSpaceSF', 'hotel-');
                }
            }
            
            // Render Office Spaces
            const officeGrid = document.getElementById('hotelOfficeSpacesGrid');
            if (officeGrid) {
                const officeSpaces = SPACE_TYPES.filter(t => t.id === 'smallOffice' || t.id === 'medOffice' || t.id === 'largeOffice');
                let html = '';
                officeSpaces.forEach(space => {
                    html += generateSpaceTypeCard(space, hotelQuantities, hotelFloorQuantities, hotelAssignByFloor, hotelShowExisting, 'updateHotelSpaceQuantity', 'updateHotelFloorQuantity', hotelSpaceSF, 'updateHotelSpaceSF', 'hotel-');
                });
                officeGrid.innerHTML = html;
            }
            
            // Render Collaboration Spaces
            const collabGrid = document.getElementById('hotelCollabSpacesGrid');
            if (collabGrid) {
                const collabSpaces = SPACE_TYPES.filter(t => t.category === 'meeting' || t.id === 'collaboration' || t.id === 'phoneRoom');
                let html = '';
                collabSpaces.forEach(space => {
                    html += generateSpaceTypeCard(space, hotelQuantities, hotelFloorQuantities, hotelAssignByFloor, hotelShowExisting, 'updateHotelSpaceQuantity', 'updateHotelFloorQuantity', hotelSpaceSF, 'updateHotelSpaceSF', 'hotel-');
                });
                collabGrid.innerHTML = html;
            }
            
            // Render Other Spaces (empty for now)
            const otherGrid = document.getElementById('hotelOtherSpacesGrid');
            if (otherGrid) {
                otherGrid.innerHTML = '';
            }
            
            updateHotelBuildingTotals();
            updateHotelCategoryTotals();
            updateHotelSpaceCalculations();
        }

        function updateHotelSpaceCalculations() {
            // Update individual space type totals
            SPACE_TYPES.forEach(type => {
                const sf = hotelSpaceSF[type.id] || type.defaultSf;
                let qty = 0;
                
                if (hotelAssignByFloor) {
                    // Use floor quantities
                    qty = hotelFloorQuantities[type.id] ? hotelFloorQuantities[type.id].reduce((a, b) => a + b, 0) : 0;
                } else {
                    // Use building-wide quantities
                    qty = hotelQuantities[type.id] || 0;
                }
                
                // Update individual space totals
                const totalEl = document.getElementById(`hotel-total-${type.id}`);
                if (totalEl) {
                    totalEl.textContent = (sf * qty).toLocaleString() + ' SF';
                }
            });
        }

        function updateHotelSpaceQuantity(id, value) {
            const newQty = parseInt(value);
            hotelQuantities[id] = newQty;
            
            if (hotelAssignByFloor) {
                if (newQty > 0) {
                    const qtyPerFloor = Math.floor(newQty / 4); // Hotel has 4 floors
                    const remainder = newQty % 4;
                    
                    hotelFloorQuantities[id] = [
                        qtyPerFloor + (remainder > 0 ? 1 : 0),
                        qtyPerFloor + (remainder > 1 ? 1 : 0),
                        qtyPerFloor + (remainder > 2 ? 1 : 0),
                        qtyPerFloor
                    ];
                } else {
                    hotelFloorQuantities[id] = [0, 0, 0, 0];
                }
                renderHotelSpaceTypes();
            }
            updateHotelSpaceCalculations();
            updateHotelBuildingTotals();
            updateHotelCategoryTotals();
            updateBuildingComparison();
        }

        function updateHotelFloorQuantity(type, floorIndex, value) {
            hotelFloorQuantities[type][floorIndex] = parseInt(value) || 0;
            const total = hotelFloorQuantities[type].reduce((a, b) => a + b, 0); // All 4 floors
            hotelQuantities[type] = total;
            updateHotelSpaceCalculations();
            updateHotelBuildingTotals();
            updateHotelCategoryTotals();
            updateBuildingComparison();
        }

        function updateHotelFloor(floorNum, value) {
            const floorValue = parseInt(value);
            hotelFloorSpaces[floorNum - 1] = floorValue;
            document.getElementById(`hotelFloor${floorNum}Value`).textContent = floorValue.toLocaleString();
            
            // Update assignable SF based on efficiency
            const efficiency = hotelFloorEfficiencies[floorNum - 1] / 100;
            const assignable = Math.round(floorValue * efficiency);
            document.getElementById(`hotelFloor${floorNum}Assignable`).textContent = assignable.toLocaleString();
            
            updateHotelBuildingTotals();
            updateBuildingComparison();
        }

        function updateHotelFloorEfficiency(floorNum, value) {
            const efficiencyValue = parseInt(value);
            hotelFloorEfficiencies[floorNum - 1] = efficiencyValue;
            document.getElementById(`hotelFloor${floorNum}EffValue`).textContent = efficiencyValue + '%';
            
            // Update assignable SF
            const gsf = hotelFloorSpaces[floorNum - 1];
            const assignable = Math.round(gsf * (efficiencyValue / 100));
            document.getElementById(`hotelFloor${floorNum}Assignable`).textContent = assignable.toLocaleString();
            
            updateHotelBuildingTotals();
            updateBuildingComparison();
        }

        function toggleHotelBuildingParams() {
            const content = document.getElementById('hotelBuildingParamsContent');
            const toggle = document.getElementById('hotelBuildingParamsToggle');
            
            if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            } else {
                content.style.maxHeight = '2000px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        function toggleHotelSpaceAllocation() {
            const content = document.getElementById('hotelSpaceAllocationContent');
            const toggle = document.getElementById('hotelSpaceAllocationToggle');
            
            if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                content.style.maxHeight = '0px';
                toggle.textContent = 'â–¶';
                toggle.style.transform = 'rotate(-90deg)';
            } else {
                content.style.maxHeight = '3000px';
                toggle.textContent = 'â–¼';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        function toggleHotelExistingData() {
            hotelShowExisting = document.getElementById('hotelShowExistingToggle').checked;
            renderHotelSpaceTypes();
        }

        function toggleHotelFloorAssignment() {
            const wasFloorMode = hotelAssignByFloor;
            hotelAssignByFloor = document.getElementById('hotelAssignByFloorToggle').checked;
            
            if (hotelAssignByFloor && !wasFloorMode) {
                // Switching TO floor mode: distribute building quantities equally across 2 floors
                SPACE_TYPES.forEach(type => {
                    const buildingQty = hotelQuantities[type.id] || 0;
                    if (buildingQty > 0) {
                        const qtyPerFloor = Math.floor(buildingQty / 2);
                        const remainder = buildingQty % 2;
                        
                        hotelFloorQuantities[type.id] = [
                            qtyPerFloor + (remainder > 0 ? 1 : 0),
                            qtyPerFloor,
                            0,
                            0
                        ];
                    } else {
                        hotelFloorQuantities[type.id] = [0, 0, 0, 0];
                    }
                });
            } else if (!hotelAssignByFloor && wasFloorMode) {
                // Switching FROM floor mode: sum floor quantities back to building total
                SPACE_TYPES.forEach(type => {
                    const floorTotal = hotelFloorQuantities[type.id] ? 
                        hotelFloorQuantities[type.id].slice(0, 2).reduce((a, b) => a + b, 0) : 0;
                    hotelQuantities[type.id] = floorTotal;
                });
            }
            
            renderHotelSpaceTypes();
            updateHotelBuildingTotals();
        }

        function updateHotelBuildingTotals() {
            // Calculate totals from floor sliders
            const totalGSF = hotelFloorSpaces.reduce((a, b) => a + b, 0);
            const totalAssignable = hotelFloorSpaces.reduce((sum, gsf, index) => {
                return sum + Math.round(gsf * (hotelFloorEfficiencies[index] / 100));
            }, 0);
            const overallEfficiency = totalGSF > 0 ? Math.round((totalAssignable / totalGSF) * 100) : 0;
            
            // Calculate space allocation totals
            let usedSF = 0;
            let workstationCount = 0;
            let officeCount = 0;
            let collabCount = 0;
            let collabSeats = 0;
            let otherCount = 0;
            
            SPACE_TYPES.forEach(type => {
                const qty = hotelQuantities[type.id] || 0;
                const sfPerUnit = hotelSpaceSF[type.id] || type.defaultSf;
                usedSF += qty * sfPerUnit;
                
                if (type.category === 'workstations') workstationCount += qty;
                if (type.category === 'offices') officeCount += qty;
                if (type.category === 'collaboration') {
                    collabCount += qty;
                    collabSeats += qty * (type.seats || 0);
                }
                if (type.category === 'other') otherCount += qty;
            });
            
            // Add Hotel custom spaces
            hotelCustomSpaces.forEach(space => {
                usedSF += space.sf * space.quantity;
                otherCount += space.quantity;
            });
            
            document.getElementById('hotelTotalAssignedSF').textContent = usedSF.toLocaleString();
            document.getElementById('hotelBuildingTotalGSF').textContent = totalGSF.toLocaleString();
            document.getElementById('hotelBuildingTotalAssignable').textContent = totalAssignable.toLocaleString();
            document.getElementById('hotelBuildingOverallEfficiency').textContent = overallEfficiency + '%';
            
            // Update Hotel comparison header
            updateHotelComparison(totalGSF, totalAssignable, workstationCount, officeCount, collabCount, collabSeats);
        }

        function updateHotelComparison(totalGSF, assignableSF, workstationCount, officeCount, collabCount, collabSeats) {
            // Existing conditions for Hotel (placeholder data)
            const existingAssignable = 30000;
            const existingWorkstation = 20;
            const existingOffice = 15;
            const existingCollab = 8;
            const existingSeats = 50;
            
            // Calculate deltas
            const deltaAssignableVal = assignableSF - existingAssignable;
            const deltaWorkstationVal = workstationCount - existingWorkstation;
            const deltaOfficeVal = officeCount - existingOffice;
            const deltaCollabVal = collabCount - existingCollab;
            const deltaSeatVal = collabSeats - existingSeats;
            
            // Format delta values with +/- sign
            const formatDelta = (val) => (val >= 0 ? '+' : '') + val.toLocaleString();
            
            // Update delta values in sticky header
            const deltaGSFEl = document.getElementById('hotelDeltaGSF');
            const deltaWorkstationsEl = document.getElementById('hotelDeltaWorkstations');
            const deltaOfficesEl = document.getElementById('hotelDeltaOffices');
            const deltaSpacesEl = document.getElementById('hotelDeltaSpaces');
            const deltaSeatsEl = document.getElementById('hotelDeltaSeats');
            
            if (deltaGSFEl) deltaGSFEl.textContent = formatDelta(deltaAssignableVal);
            if (deltaWorkstationsEl) deltaWorkstationsEl.textContent = formatDelta(deltaWorkstationVal);
            if (deltaOfficesEl) deltaOfficesEl.textContent = formatDelta(deltaOfficeVal);
            if (deltaSpacesEl) deltaSpacesEl.textContent = formatDelta(deltaCollabVal);
            if (deltaSeatsEl) deltaSeatsEl.textContent = formatDelta(deltaSeatVal);
        }


        // Building Comparison Function
        function updateBuildingComparison() {
            // Calculate Admin Building totals from floor sliders
            const adminTotalGSF = floorSpaces.reduce((a, b) => a + b, 0);
            const adminAssignableSF = floorSpaces.reduce((sum, gsf, index) => {
                return sum + Math.round(gsf * (floorEfficiencies[index] / 100));
            }, 0);
            const adminUsedSF = SPACE_TYPES.reduce((total, type) => {
                const sfPerUnit = spaceSF[type.id] || type.defaultSf;
                return total + (quantities[type.id] || 0) * sfPerUnit;
            }, 0);
            const adminEfficiency = adminTotalGSF > 0 ? Math.round((adminAssignableSF / adminTotalGSF) * 100) : 0;
            
            // Calculate ICC Building totals from floor sliders
            const iccTotalGSF = iccFloorSpaces.reduce((a, b) => a + b, 0);
            const iccAssignableSF = iccFloorSpaces.reduce((sum, gsf, index) => {
                return sum + Math.round(gsf * (iccFloorEfficiencies[index] / 100));
            }, 0);
            const iccUsedSF = SPACE_TYPES.reduce((total, type) => {
                const sfPerUnit = iccSpaceSF[type.id] || type.defaultSf;
                return total + (iccQuantities[type.id] || 0) * sfPerUnit;
            }, 0) + iccCustomSpaces.reduce((total, space) => total + space.sf * space.quantity, 0);
            const iccEfficiency = iccTotalGSF > 0 ? Math.round((iccAssignableSF / iccTotalGSF) * 100) : 0;
            
            // Calculate Hotel Building totals from floor sliders
            const hotelTotalGSF = hotelFloorSpaces.reduce((a, b) => a + b, 0);
            const hotelAssignableSF = hotelFloorSpaces.reduce((sum, gsf, index) => {
                return sum + Math.round(gsf * (hotelFloorEfficiencies[index] / 100));
            }, 0);
            const hotelUsedSF = SPACE_TYPES.reduce((total, type) => {
                const sfPerUnit = hotelSpaceSF[type.id] || type.defaultSf;
                return total + (hotelQuantities[type.id] || 0) * sfPerUnit;
            }, 0) + hotelCustomSpaces.reduce((total, space) => total + space.sf * space.quantity, 0);
            const hotelEfficiency = hotelTotalGSF > 0 ? Math.round((hotelAssignableSF / hotelTotalGSF) * 100) : 0;
            
            // Calculate combined totals
            const combinedTotalGSF = adminTotalGSF + iccTotalGSF + hotelTotalGSF;
            const combinedAssignableSF = adminAssignableSF + iccAssignableSF + hotelAssignableSF;
            const combinedUsedSF = adminUsedSF + iccUsedSF + hotelUsedSF;
            const combinedEfficiency = combinedTotalGSF > 0 ? Math.round((combinedAssignableSF / combinedTotalGSF) * 100) : 0;
            
            // Update comparison display
            document.getElementById('adminTotalGSF').textContent = adminTotalGSF.toLocaleString();
            document.getElementById('adminAssignableSF').textContent = adminAssignableSF.toLocaleString();
            document.getElementById('adminUsedSF').textContent = adminUsedSF.toLocaleString();
            document.getElementById('adminEfficiency').textContent = `${adminEfficiency}%`;
            
            document.getElementById('iccTotalGSF').textContent = iccTotalGSF.toLocaleString();
            document.getElementById('iccAssignableSF').textContent = iccAssignableSF.toLocaleString();
            document.getElementById('iccUsedSF').textContent = iccUsedSF.toLocaleString();
            document.getElementById('iccEfficiency').textContent = `${iccEfficiency}%`;
            
            document.getElementById('hotelTotalGSF').textContent = hotelTotalGSF.toLocaleString();
            document.getElementById('hotelAssignableSF').textContent = hotelAssignableSF.toLocaleString();
            document.getElementById('hotelUsedSF').textContent = hotelUsedSF.toLocaleString();
            document.getElementById('hotelEfficiency').textContent = `${hotelEfficiency}%`;
            
            document.getElementById('combinedTotalGSF').textContent = combinedTotalGSF.toLocaleString();
            document.getElementById('combinedAssignableSF').textContent = combinedAssignableSF.toLocaleString();
            document.getElementById('combinedUsedSF').textContent = combinedUsedSF.toLocaleString();
            document.getElementById('combinedEfficiency').textContent = `${combinedEfficiency}%`;
            
            // Update remaining SF in headers
            const adminRemainingSF = adminAssignableSF - adminUsedSF;
            const iccRemainingSF = iccAssignableSF - iccUsedSF;
            const hotelRemainingSF = hotelAssignableSF - hotelUsedSF;
            
            document.getElementById('remainingSF').textContent = adminRemainingSF.toLocaleString();
            document.getElementById('iccRemainingSF').textContent = iccRemainingSF.toLocaleString();
            document.getElementById('hotelRemainingSF').textContent = hotelRemainingSF.toLocaleString();
        }

        function toggleFloorAssignment() {
            const wasFloorMode = assignByFloor;
            assignByFloor = document.getElementById('assignByFloorToggle').checked;
            
            if (assignByFloor && !wasFloorMode) {
                // Switching TO floor mode: distribute building quantities equally across floors
                SPACE_TYPES.forEach(type => {
                    const buildingQty = quantities[type.id] || 0;
                    if (buildingQty > 0) {
                        const qtyPerFloor = Math.floor(buildingQty / 4);
                        const remainder = buildingQty % 4;
                        
                        // Distribute equally with remainder to first floors
                        floorQuantities[type.id] = [
                            qtyPerFloor + (remainder > 0 ? 1 : 0),
                            qtyPerFloor + (remainder > 1 ? 1 : 0),
                            qtyPerFloor + (remainder > 2 ? 1 : 0),
                            qtyPerFloor
                        ];
                    } else {
                        floorQuantities[type.id] = [0, 0, 0, 0];
                    }
                });
            } else if (!assignByFloor && wasFloorMode) {
                // Switching FROM floor mode: sum floor quantities back to building total
                SPACE_TYPES.forEach(type => {
                    const floorTotal = floorQuantities[type.id] ? 
                        floorQuantities[type.id].reduce((a, b) => a + b, 0) : 0;
                    quantities[type.id] = floorTotal;
                });
            }
            
            renderSpaceTypes();
            updateSpaceCalculations();
        }

        function renderSpaceTypes(customQuantities = quantities, customFloorQuantities = floorQuantities, customAssignByFloor = assignByFloor, customShowExisting = showExisting, updateQuantityFunc = 'updateSpaceQuantity', updateFloorQuantityFunc = 'updateFloorQuantity', customSpaceSF = spaceSF, updateSpaceSFFunc = 'updateSpaceSF') {
            // Categorize space types
            const workstationSpaces = SPACE_TYPES.filter(t => t.id === 'workstation');
            const officeSpaces = SPACE_TYPES.filter(t => t.id === 'smallOffice' || t.id === 'medOffice' || t.id === 'largeOffice');
            const collabSpaces = SPACE_TYPES.filter(t => t.category === 'meeting' || t.id === 'collaboration' || t.id === 'phoneRoom');
            const otherSpaces = []; // Only custom spaces will be in "Other"
            
            const renderGrid = (types, gridId) => {
                const grid = document.getElementById(gridId);
            if (!grid) return;
            
            // Use custom data instead of global variables
            const currentQuantities = customQuantities;
            const currentFloorQuantities = customFloorQuantities;
            const currentAssignByFloor = customAssignByFloor;
            const currentShowExisting = customShowExisting;
            
                grid.innerHTML = types.map(type => {
                    const existingQty = existingQuantities[type.id] || 0;
                    const existingSF = type.defaultSf;
                    const existingTotal = existingQty * existingSF;
                    const currentQty = currentQuantities[type.id] || 0;
                    
                    if (currentAssignByFloor) {
                        // Floor-by-floor assignment
                        return `
                <div class="space-type-card">
                    <div class="space-type-header">
                        <div class="space-type-name">${type.name}</div>
                        <div class="space-type-color" style="background-color: ${type.color}"></div>
                            </div>
                            ${showExisting ? `
                            <div style="margin-bottom: 8px;">
                                <div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">EXISTING</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 4px; font-size: 0.65rem;">
                                    <div>
                                        <div style="color: var(--umgc-text-light); font-weight: 600;">F1</div>
                                        <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][0] || 0}</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--umgc-text-light); font-weight: 600;">F2</div>
                                        <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][1] || 0}</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--umgc-text-light); font-weight: 600;">F3</div>
                                        <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][2] || 0}</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--umgc-text-light); font-weight: 600;">F4</div>
                                        <div style="color: var(--umgc-navy); font-weight: 700;">${existingFloorQuantities[type.id][3] || 0}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 4px; text-align: center; font-size: 0.65rem; color: var(--umgc-text-light);">
                                    Total: ${existingQty} units
                                </div>
                            </div>
                            ` : ''}
                            <div style="margin-bottom: 6px;">
                                ${showExisting ? '<div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">PLANNED BY FLOOR</div>' : ''}
                                <div class="space-input-group" style="margin-bottom: 8px;">
                                    <label class="space-input-label">SF per Unit</label>
                                    <input type="number" class="space-input" value="${customSpaceSF[type.id] || type.defaultSf}" 
                                           onchange="${updateSpaceSFFunc}('${type.id}', this.value)" min="1" style="max-width: 100px; width: 100px;">
                    </div>
                                <div class="space-type-inputs">
                                    <div class="space-input-group">
                                        <label class="space-input-label">Floor 1</label>
                                        <input type="number" class="space-input" value="${currentFloorQuantities[type.id][0] || 0}" 
                                               onchange="${updateFloorQuantityFunc}('${type.id}', 0, this.value)" min="0" style="max-width: 60px; width: 60px;">
                                    </div>
                                    <div class="space-input-group">
                                        <label class="space-input-label">Floor 2</label>
                                        <input type="number" class="space-input" value="${currentFloorQuantities[type.id][1] || 0}" 
                                               onchange="${updateFloorQuantityFunc}('${type.id}', 1, this.value)" min="0" style="max-width: 60px; width: 60px;">
                                    </div>
                                    <div class="space-input-group">
                                        <label class="space-input-label">Floor 3</label>
                                        <input type="number" class="space-input" value="${currentFloorQuantities[type.id][2] || 0}" 
                                               onchange="${updateFloorQuantityFunc}('${type.id}', 2, this.value)" min="0" style="max-width: 60px; width: 60px;">
                                    </div>
                                    <div class="space-input-group">
                                        <label class="space-input-label">Floor 4</label>
                                        <input type="number" class="space-input" value="${currentFloorQuantities[type.id][3] || 0}" 
                                               onchange="${updateFloorQuantityFunc}('${type.id}', 3, this.value)" min="0" style="max-width: 60px; width: 60px;">
                                    </div>
                                </div>
                                <div style="text-align: center; font-size: 0.75rem; color: var(--umgc-navy); font-weight: 600; margin-top: 4px;">
                                    Total: <span id="qty-${type.id}">${currentFloorQuantities[type.id].reduce((a, b) => a + b, 0)}</span> units
                                </div>
                                <div class="space-type-total">
                                    <span class="space-total-label">Total SF:</span>
                                    <span class="space-total-value" id="${buildingPrefix}total-${type.id}">0 SF</span>
                                </div>
                            </div>
                        </div>
                        `;
                    } else {
                        // Building-wide assignment (original)
                        return `
                        <div class="space-type-card">
                            <div class="space-type-header">
                                <div class="space-type-name">${type.name}</div>
                                <div class="space-type-color" style="background-color: ${type.color}"></div>
                            </div>
                            ${showExisting ? `
                            <div style="margin-bottom: 8px;">
                                <div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">EXISTING</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 4px; font-size: 0.7rem;">
                                    <div>
                                        <div style="color: var(--umgc-text-light); font-weight: 600;">Qty</div>
                                        <div style="color: var(--umgc-navy); font-weight: 700;">${existingQty}</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--umgc-text-light); font-weight: 600;">SF</div>
                                        <div style="color: var(--umgc-navy); font-weight: 700;">${existingSF}</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--umgc-text-light); font-weight: 600;">Total</div>
                                        <div style="color: var(--umgc-navy); font-weight: 700;">${existingTotal.toLocaleString()}</div>
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                            <div style="margin-bottom: 6px;">
                                ${showExisting ? '<div style="font-size: 0.7rem; font-weight: 600; color: var(--umgc-text-light); margin-bottom: 3px;">PLANNED</div>' : ''}
                    <div class="space-type-inputs">
                        <div class="space-input-group">
                            <label class="space-input-label">SF per Unit</label>
                            <input type="number" class="space-input" value="${customSpaceSF[type.id] || type.defaultSf}" 
                                   onchange="${updateSpaceSFFunc}('${type.id}', this.value)" min="1">
                        </div>
                                    <div class="space-input-group" style="flex: 1.5;">
                                        <label class="space-input-label">Qty</label>
                                        <input type="range" class="slider" min="0" max="100" value="${currentQty}" 
                                               step="1" oninput="${updateQuantityFunc}('${type.id}', this.value)">
                        </div>
                        <div class="space-input-group">
                                        <label class="space-input-label">Count</label>
                                        <div class="space-qty-display" id="qty-${type.id}">${currentQty}</div>
                        </div>
                    </div>
                    <div class="space-type-total">
                        <span class="space-total-label">Total SF:</span>
                        <span class="space-total-value" id="total-${type.id}">0 SF</span>
                    </div>
                </div>
                        </div>
                        `;
                    }
                }).join('');
            };
            
            renderGrid(workstationSpaces, 'workstationSpacesGrid');
            renderGrid(officeSpaces, 'officeSpacesGrid');
            renderGrid(collabSpaces, 'collabSpacesGrid');
            renderGrid(otherSpaces, 'otherSpacesGrid');
        }

        function addCustomSpace() {
            const name = document.getElementById('customName').value;
            const sf = document.getElementById('customSF').value;
            const qty = document.getElementById('customQty').value;
            
            if (name && sf && qty) {
                const newSpace = {
                    id: `custom-${Date.now()}`,
                    name: name,
                    sf: parseInt(sf),
                    quantity: parseInt(qty)
                };
                
                customSpaces.push(newSpace);
                
                // Clear inputs
                document.getElementById('customName').value = '';
                document.getElementById('customSF').value = '';
                document.getElementById('customQty').value = '';
                
                renderCustomSpaces();
                updateSpaceCalculations();
            }
        }

        function removeCustomSpace(id) {
            customSpaces = customSpaces.filter(space => space.id !== id);
            renderCustomSpaces();
            updateSpaceCalculations();
        }

        // ICC Custom Spaces Functions
        function addICCCustomSpace() {
            const name = document.getElementById('iccCustomName').value;
            const sf = document.getElementById('iccCustomSF').value;
            const qty = document.getElementById('iccCustomQty').value;
            
            if (name && sf && qty) {
                const newSpace = {
                    id: `icc-custom-${Date.now()}`,
                    name: name,
                    sf: parseInt(sf),
                    quantity: parseInt(qty)
                };
                
                iccCustomSpaces.push(newSpace);
                
                // Clear inputs
                document.getElementById('iccCustomName').value = '';
                document.getElementById('iccCustomSF').value = '';
                document.getElementById('iccCustomQty').value = '';
                
                updateICCCustomSpacesList();
                updateICCBuildingTotals();
                updateBuildingComparison();
            }
        }

        function removeICCCustomSpace(id) {
            iccCustomSpaces = iccCustomSpaces.filter(space => space.id !== id);
            updateICCCustomSpacesList();
            updateICCBuildingTotals();
            updateBuildingComparison();
        }

        function updateICCCustomSpacesList() {
            const list = document.getElementById('iccCustomSpacesList');
            if (!list) return;
            
            if (iccCustomSpaces.length === 0) {
                list.innerHTML = '';
                return;
            }
            
            list.innerHTML = '<div class="space-types-grid">' + iccCustomSpaces.map(space => `
                <div class="space-type-card" style="position: relative;">
                    <button class="remove-space-button" onclick="removeICCCustomSpace('${space.id}')" style="position: absolute; top: 10px; right: 10px; background: #dc2626; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                    <div class="space-type-header">
                        <div class="space-type-name">${space.name}</div>
                        <div class="space-type-color" style="background-color: hsl(280, 65%, 70%);"></div>
                    </div>
                    <div class="space-type-total">
                        <span class="space-total-label">Total SF:</span>
                        <span class="space-total-value" id="icc-custom-total-${space.id}">${(space.sf * space.quantity).toLocaleString()} SF</span>
                    </div>
                </div>
            `).join('') + '</div>';
        }

        // Hotel Custom Spaces Functions
        function addHotelCustomSpace() {
            const name = document.getElementById('hotelCustomName').value;
            const sf = document.getElementById('hotelCustomSF').value;
            const qty = document.getElementById('hotelCustomQty').value;
            
            if (name && sf && qty) {
                const newSpace = {
                    id: `hotel-custom-${Date.now()}`,
                    name: name,
                    sf: parseInt(sf),
                    quantity: parseInt(qty)
                };
                
                hotelCustomSpaces.push(newSpace);
                
                // Clear inputs
                document.getElementById('hotelCustomName').value = '';
                document.getElementById('hotelCustomSF').value = '';
                document.getElementById('hotelCustomQty').value = '';
                
                updateHotelCustomSpacesList();
                updateHotelBuildingTotals();
                updateBuildingComparison();
            }
        }

        function removeHotelCustomSpace(id) {
            hotelCustomSpaces = hotelCustomSpaces.filter(space => space.id !== id);
            updateHotelCustomSpacesList();
            updateHotelBuildingTotals();
            updateBuildingComparison();
        }

        function updateHotelCustomSpacesList() {
            const list = document.getElementById('hotelCustomSpacesList');
            if (!list) return;
            
            if (hotelCustomSpaces.length === 0) {
                list.innerHTML = '';
                return;
            }
            
            list.innerHTML = '<div class="space-types-grid">' + hotelCustomSpaces.map(space => `
                <div class="space-type-card" style="position: relative;">
                    <button class="remove-space-button" onclick="removeHotelCustomSpace('${space.id}')" style="position: absolute; top: 10px; right: 10px; background: #dc2626; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                    <div class="space-type-header">
                        <div class="space-type-name">${space.name}</div>
                        <div class="space-type-color" style="background-color: hsl(280, 65%, 70%);"></div>
                    </div>
                    <div class="space-type-total">
                        <span class="space-total-label">Total SF:</span>
                        <span class="space-total-value" id="hotel-custom-total-${space.id}">${(space.sf * space.quantity).toLocaleString()} SF</span>
                    </div>
                </div>
            `).join('') + '</div>';
        }

        function renderCustomSpaces() {
            const list = document.getElementById('customSpacesList');
            if (!list) return;
            
            if (customSpaces.length === 0) {
                list.innerHTML = '';
                return;
            }
            
            list.innerHTML = '<div class="space-types-grid">' + customSpaces.map(space => `
                <div class="space-type-card" style="position: relative;">
                    <button class="remove-space-button" onclick="removeCustomSpace('${space.id}')" style="position: absolute; top: 10px; right: 10px; background: #dc2626; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                    <div class="space-type-header">
                        <div class="space-type-name">${space.name}</div>
                        <div class="space-type-color" style="background-color: hsl(280, 65%, 70%);"></div>
                        </div>
                    <div class="space-type-inputs">
                        <div class="space-input-group">
                            <label class="space-input-label">SF per Unit</label>
                            <div class="space-input" style="padding: 8px; background: #f5f5f5; border-radius: 4px;">${space.sf}</div>
                    </div>
                        <div class="space-input-group">
                            <label class="space-input-label">Qty</label>
                            <div class="space-qty-display">${space.quantity}</div>
                </div>
                    </div>
                    <div class="space-type-total">
                        <span class="space-total-label">Total SF:</span>
                        <span class="space-total-value">${(space.quantity * space.sf).toLocaleString()} SF</span>
                    </div>
                </div>
            `).join('') + '</div>';
        }

        function createSpaceCharts() {
            // Category comparison chart
            const ctxCategory = document.getElementById('categoryComparisonChart');
            if (ctxCategory && !categoryChart) {
                console.log('Creating category chart...');
                categoryChart = new Chart(ctxCategory, {
                    type: 'bar',
                    data: {
                        labels: ['Workstations', 'Private Offices', 'Collaboration Spaces', 'Other Spaces'],
                        datasets: [{
                            label: 'Existing',
                            data: [3000, 3750, 2375, 0], // Initial data
                            backgroundColor: 'rgba(220, 38, 38, 0.8)',
                            borderColor: 'rgba(220, 38, 38, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Planned',
                            data: [0, 0, 0, 0], // Initial data
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: 'rgba(34, 197, 94, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        aspectRatio: 1.5,
                        plugins: {
                            legend: { 
                                position: 'top',
                                labels: {
                                    boxWidth: 15,
                                    padding: 10
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' SF';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                title: { display: true, text: 'Square Feet' },
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            },
                            x: { 
                                ticks: { 
                                    maxRotation: 45, 
                                    minRotation: 0
                                }
                            }
                        }
                    }
                });
            }
            
            // Type comparison chart
            const ctxType = document.getElementById('typeComparisonChart');
            if (ctxType && !typeChart) {
                console.log('Creating type chart...');
                typeChart = new Chart(ctxType, {
                    type: 'bar',
                    data: {
                        labels: ['Open Workstation', 'Private Office', 'Phone Room', 'Huddle/Interview Room (2p)', 'Small Meeting Room (6p)', 'Medium Meeting Room (12p)'],
                        datasets: [{
                            label: 'Existing',
                            data: [3000, 3750, 225, 600, 750, 800], // Initial data
                            backgroundColor: 'rgba(220, 38, 38, 0.8)',
                            borderColor: 'rgba(220, 38, 38, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Planned',
                            data: [0, 0, 0, 0, 0, 0], // Initial data
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: 'rgba(34, 197, 94, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        aspectRatio: 1.5,
                        plugins: {
                            legend: { 
                                position: 'top',
                                labels: {
                                    boxWidth: 15,
                                    padding: 10
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' SF';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                title: { display: true, text: 'Square Feet' },
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            },
                            x: { 
                                ticks: { 
                                    maxRotation: 45, 
                                    minRotation: 45,
                                    autoSkip: false
                                }
                            }
                        }
                    }
                });
            }
        }

        function updateSpaceCharts() {
            // Ensure charts are created first
            if (!categoryChart || !typeChart) {
                createSpaceCharts();
            if (!categoryChart || !typeChart) return;
            }
            
            // Existing data (placeholder values)
            const existingData = {
                workstations: 3000, // 40 spaces * 75 SF
                offices: 3750,      // 25 spaces * 150 SF
                meeting: 2375,      // 12 spaces * ~198 SF average
                support: 0
            };
            
            // Calculate planned category summary
            const plannedCategorySummary = {
                workstations: { count: 0, sf: 0 },
                offices: { count: 0, sf: 0 },
                meeting: { count: 0, sf: 0 },
                support: { count: 0, sf: 0 }
            };
            
            SPACE_TYPES.forEach(type => {
                const qty = quantities[type.id] || 0;
                const sf = spaceSF[type.id] || type.defaultSf;
                plannedCategorySummary[type.category].count += qty;
                plannedCategorySummary[type.category].sf += sf * qty;
            });
            
            // Update category comparison chart
            const categoryLabels = ['Workstations', 'Private Offices', 'Collaboration Spaces', 'Other Spaces'];
            const existingCategoryData = [
                existingData.workstations,
                existingData.offices,
                existingData.meeting,
                existingData.support
            ];
            const plannedCategoryData = [
                plannedCategorySummary.workstations.sf,
                plannedCategorySummary.offices.sf,
                plannedCategorySummary.meeting.sf,
                plannedCategorySummary.support.sf
            ];
            
            // Use category colors
            const categoryColors = [
                'hsl(217, 91%, 60%)', // Workstations - Blue
                'hsl(142, 76%, 36%)', // Offices - Green
                'hsl(47, 96%, 53%)',  // Collaboration - Yellow
                'hsl(280, 65%, 60%)'  // Other - Purple
            ];
            
            categoryChart.data.datasets[0].data = existingCategoryData;
            categoryChart.data.datasets[0].backgroundColor = categoryColors.map(color => color.replace(')', ', 0.8)').replace('hsl(', 'hsla('));
            categoryChart.data.datasets[1].data = plannedCategoryData;
            categoryChart.data.datasets[1].backgroundColor = categoryColors.map(color => color.replace(')', ', 0.8)').replace('hsl(', 'hsla('));
            categoryChart.update();
            
            // Update type comparison chart
            const existingTypeData = {
                'Workstation': 3000,
                'Small Office': 1500,
                'Medium Office': 1200,
                'Large Office': 1050,
                'Phone Room': 225,
                'Huddle/Interview Room (2p)': 600,
                'Small Meeting Room (6p)': 750,
                'Medium Meeting Room (12p)': 800
            };
            
            const typeLabels = [];
            const existingTypeValues = [];
            const plannedTypeValues = [];
            const existingColors = [];
            const plannedColors = [];
            
            SPACE_TYPES.forEach(type => {
                const qty = quantities[type.id] || 0;
                const sf = spaceSF[type.id] || type.defaultSf;
                const plannedSF = sf * qty;
                
                if (existingTypeData[type.name] || plannedSF > 0) {
                    typeLabels.push(type.name);
                    existingTypeValues.push(existingTypeData[type.name] || 0);
                    plannedTypeValues.push(plannedSF);
                    existingColors.push(type.color);
                    plannedColors.push(type.color);
                }
            });
            
            typeChart.data.labels = typeLabels;
            typeChart.data.datasets[0].data = existingTypeValues;
            typeChart.data.datasets[0].backgroundColor = existingColors;
            typeChart.data.datasets[1].data = plannedTypeValues;
            typeChart.data.datasets[1].backgroundColor = plannedColors;
            typeChart.update();
        }

        function updateCategorySummary() {
            const tbody = document.getElementById('categorySummaryBody');
            if (!tbody) return;
            
            const categorySummary = {
                workstations: { count: 0, sf: 0 },
                offices: { count: 0, sf: 0 },
                meeting: { count: 0, sf: 0 },
                support: { count: 0, sf: 0 }
            };
            
            SPACE_TYPES.forEach(type => {
                const qty = quantities[type.id] || 0;
                const sf = spaceSF[type.id] || type.defaultSf;
                categorySummary[type.category].count += qty;
                categorySummary[type.category].sf += sf * qty;
            });
            
            const totalSF = Object.values(categorySummary).reduce((sum, cat) => sum + cat.sf, 0);
            
            tbody.innerHTML = Object.entries(categorySummary).map(([key, value]) => `
                <tr>
                    <td class="font-medium">${CATEGORY_NAMES[key]}</td>
                    <td class="text-right">${value.count}</td>
                    <td class="text-right">${value.sf.toLocaleString()}</td>
                    <td class="text-right">${totalSF > 0 ? ((value.sf / totalSF) * 100).toFixed(1) : 0}%</td>
                    <td>
                        <div class="color-swatch" style="background-color: ${CATEGORY_COLORS[key]}"></div>
                    </td>
                </tr>
            `).join('');
        }

        function updateDetailedTable() {
            const tbody = document.getElementById('detailedSpaceBody');
            if (!tbody) return;
            
            let rows = SPACE_TYPES.map(type => {
                const qty = quantities[type.id] || 0;
                const sf = spaceSF[type.id] || type.defaultSf;
                const total = qty * sf;
                
                return `
                    <tr>
                        <td class="font-medium">${type.name}</td>
                        <td>${CATEGORY_NAMES[type.category]}</td>
                        <td class="text-right">${sf}</td>
                        <td class="text-right">${qty}</td>
                        <td class="text-right">${total.toLocaleString()}</td>
                        <td>
                            <div class="color-swatch" style="background-color: ${type.color}"></div>
                        </td>
                    </tr>
                `;
            });
            
            customSpaces.forEach(space => {
                rows.push(`
                    <tr>
                        <td class="font-medium">${space.name}</td>
                        <td>Custom</td>
                        <td class="text-right">${space.sf}</td>
                        <td class="text-right">${space.quantity}</td>
                        <td class="text-right">${(space.sf * space.quantity).toLocaleString()}</td>
                        <td>
                            <div class="color-swatch" style="background-color: #9ca3af"></div>
                        </td>
                    </tr>
                `);
            });
            
            tbody.innerHTML = rows.join('');
        }

        function showCapacityAlert(assignable, used, remaining) {
            document.getElementById('alertAssignableSF').textContent = assignable.toLocaleString();
            document.getElementById('alertUsedSF').textContent = used.toLocaleString();
            document.getElementById('alertOverSF').textContent = Math.abs(remaining).toLocaleString();
            document.getElementById('capacityAlert').style.display = 'flex';
        }

        function closeCapacityAlert() {
            document.getElementById('capacityAlert').style.display = 'none';
        }

        // Initialize on page load if Dashboard 1 is active
        window.addEventListener('load', function() {
            if (document.getElementById('dashboard1').classList.contains('active')) {
                initSpacePlanning();
            }
        });
    </script>
    
    <script>
        // Initialize charts when page loads
        window.addEventListener('load', function() {
            console.log('Page loaded, initializing charts...');
            try {
                createSpaceCharts();
                updateSpaceCharts();
                console.log('Charts initialized successfully');
            } catch (error) {
                console.error('Error initializing charts:', error);
            }
        });
    </script>
</body>
</html>

